# ä½œä¸š8

>   IPsec åè®®æ˜¯å¦èƒ½é˜²æ­¢é‡æ”¾æ”»å‡»ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ

å¯ä»¥ï¼ŒIPsecåè®®ä¸ºæ¯ä¸ªæ•°æ®åŒ…åˆ†é…äº†ä¸€ä¸ªå”¯ä¸€çš„åºåˆ—å·ã€‚æ¥æ”¶æ–¹åœ¨æ”¶åˆ°æ•°æ®åŒ…åï¼Œä¼šæ£€æŸ¥å…¶åºåˆ—å·æ˜¯å¦å·²ç»å‡ºç°è¿‡ã€‚å¦‚æœåºåˆ—å·å·²ç»å‡ºç°è¿‡ï¼Œé‚£ä¹ˆè¯´æ˜è¿™æ˜¯ä¸€ä¸ªé‡æ”¾çš„æ•°æ®åŒ…ï¼Œå°†è¢«ä¸¢å¼ƒã€‚è¿™æ ·ï¼ŒIPsecå°±ç¡®ä¿äº†æ¯ä¸ªæ•°æ®åŒ…çš„å”¯ä¸€æ€§ï¼Œé˜²æ­¢äº†é‡æ”¾æ”»å‡»ã€‚

>   TLS/SSLåè®®ç”±å“ªäº›åè®®æ„æˆï¼Ÿåˆ†åˆ«å®Œæˆä»€ä¹ˆåŠŸèƒ½ï¼Ÿ

### 1. æ¡æ‰‹åè®® (Handshake Protocol)
æ¡æ‰‹åè®®æ˜¯TLS/SSLçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹å®‰å…¨è¿æ¥ã€‚å®ƒä¸»è¦å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š

- **èº«ä»½éªŒè¯**ï¼šé€šè¿‡æ•°å­—è¯ä¹¦éªŒè¯æœåŠ¡å™¨ï¼ˆæœ‰æ—¶ä¹ŸéªŒè¯å®¢æˆ·ç«¯ï¼‰çš„èº«ä»½ã€‚
- **å¯†é’¥äº¤æ¢**ï¼šåå•†ä¸€ä¸ªå¯¹ç§°åŠ å¯†å¯†é’¥ï¼Œç”¨äºåç»­çš„æ•°æ®åŠ å¯†ã€‚
- **åè®®åå•†**ï¼šç¡®å®šä½¿ç”¨çš„TLS/SSLç‰ˆæœ¬å’ŒåŠ å¯†ç®—æ³•ã€‚
- **ä¼šè¯å»ºç«‹**ï¼šç”Ÿæˆä¼šè¯å¯†é’¥ï¼Œç”¨äºåŠ å¯†æ•°æ®ä¼ è¾“ã€‚

### 2. è®°å½•åè®® (Record Protocol)
è®°å½•åè®®è´Ÿè´£å°†æ•°æ®åˆ†å‰²æˆåˆé€‚çš„å¤§å°ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤ã€‚å®ƒä¸»è¦å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š

- **æ•°æ®åˆ†å‰²**ï¼šå°†åº”ç”¨å±‚ä¼ è¾“çš„æ•°æ®åˆ†å‰²æˆé€‚åˆå¤§å°çš„è®°å½•ã€‚
- **å‹ç¼©**ï¼šï¼ˆå¯é€‰ï¼‰å¯¹æ•°æ®è¿›è¡Œå‹ç¼©ä»¥å‡å°‘ä¼ è¾“æ•°æ®é‡ã€‚
- **åŠ å¯†**ï¼šä½¿ç”¨åå•†å¥½çš„å¯¹ç§°å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚
- **å®Œæ•´æ€§ä¿æŠ¤**ï¼šç”Ÿæˆæ¶ˆæ¯éªŒè¯ç ï¼ˆMACï¼‰ä»¥ç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚

### 3. æŠ¥è­¦åè®® (Alert Protocol)
æŠ¥è­¦åè®®ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’è­¦æŠ¥æ¶ˆæ¯ï¼Œé€šçŸ¥å¯¹æ–¹å‘ç”Ÿäº†æŸäº›äº‹ä»¶ã€‚è­¦æŠ¥æ¶ˆæ¯å¯ä»¥æ˜¯è­¦å‘Šæˆ–è‡´å‘½é”™è¯¯ã€‚å®ƒä¸»è¦å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š

- **è­¦å‘Š**ï¼šé€šçŸ¥å¯¹æ–¹ä¸€äº›éè‡´å‘½é”™è¯¯æˆ–äº‹ä»¶ï¼ˆå¦‚å³å°†å…³é—­è¿æ¥ï¼‰ã€‚
- **è‡´å‘½é”™è¯¯**ï¼šé€šçŸ¥å¯¹æ–¹å‘ç”Ÿäº†è‡´å‘½é”™è¯¯ï¼Œè¿æ¥å°†è¢«ç»ˆæ­¢ï¼ˆå¦‚è¯ä¹¦éªŒè¯å¤±è´¥ã€è§£å¯†å¤±è´¥ç­‰ï¼‰ã€‚

### 4. å˜æ›´å¯†ç è§„èŒƒåè®® (Change Cipher Spec Protocol)
å˜æ›´å¯†ç è§„èŒƒåè®®æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„åè®®ï¼Œç”¨äºé€šçŸ¥å¯¹æ–¹åœ¨åç»­é€šä¿¡ä¸­å°†ä½¿ç”¨æ–°çš„åŠ å¯†ç®—æ³•å’Œå¯†é’¥ã€‚å®ƒä¸»è¦å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š

- **å¯†ç è§„èŒƒå˜æ›´**ï¼šé€šçŸ¥å¯¹æ–¹ä»æ­¤åˆ»èµ·ä½¿ç”¨æ–°çš„åŠ å¯†å‚æ•°ï¼ˆå¦‚ä¼šè¯å¯†é’¥å’ŒåŠ å¯†ç®—æ³•ï¼‰ã€‚

### 5. åº”ç”¨æ•°æ®åè®® (Application Data Protocol)
åº”ç”¨æ•°æ®åè®®ç”¨äºä¼ è¾“åº”ç”¨å±‚çš„æ•°æ®ã€‚å®ƒä¸»è¦å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š

- **æ•°æ®ä¼ è¾“**ï¼šåœ¨å»ºç«‹å®‰å…¨è¿æ¥åï¼Œä¼ è¾“åŠ å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤çš„åº”ç”¨å±‚æ•°æ®ï¼ˆå¦‚HTTPè¯·æ±‚å’Œå“åº”ï¼‰ã€‚

>   SSLè¿æ¥å’ŒSSLä¼šè¯ä¹‹é—´æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

-   è¿æ¥ï¼šæä¾›åˆé€‚æœåŠ¡ç±»å‹çš„ä¼ è¾“ã€‚
    -   ç‰¹ç‚¹ï¼šè¿æ¥æ˜¯å¯¹ç­‰çš„ï¼Œæš‚æ—¶çš„å’Œå…³è”çš„(æŒ‡å’Œä¼šè¯ï¼‰

-   ä¼šè¯ï¼š æ˜¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„å…³è”

å¦‚ä¸‹å›¾ğŸ‘‡ğŸ»

![124824239](/Users/wwt13/Documents/Notes/assets/124824239.webp)

>   è€ƒè™‘Webçš„å®‰å…¨å¨èƒï¼Œå¦‚ä¸­é—´äººæ”»å‡»ï¼Œå£ä»¤å—…æ¢ã€IPåŠ«æŒç­‰ï¼Œç»“åˆTLS/SSLåè®®çš„ç‰¹ç‚¹è¯´æ˜æ¯ä¸ªå¨èƒæ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ

### 1. ä¸­é—´äººæ”»å‡»ï¼ˆMan-in-the-Middle Attack, MITMï¼‰
ä¸­é—´äººæ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ‹¦æˆªå’Œç¯¡æ”¹é€šä¿¡å†…å®¹ï¼Œä»è€Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–æ“çºµæ•°æ®ã€‚

**TLS/SSLè§£å†³æ–¹å¼ï¼š**
- **æ•°å­—è¯ä¹¦å’Œèº«ä»½éªŒè¯**ï¼šåœ¨æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯æä¾›æ•°å­—è¯ä¹¦ï¼Œå®¢æˆ·ç«¯éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼Œç¡®ä¿æœåŠ¡å™¨çš„èº«ä»½çœŸå®ã€‚è‹¥è¯ä¹¦æ— æ•ˆæˆ–ä¸å¯ä¿¡ï¼Œå®¢æˆ·ç«¯ä¼šç»ˆæ­¢è¿æ¥ã€‚
- **åŠ å¯†é€šä¿¡**ï¼šæ¡æ‰‹åè®®åå•†å‡ºå…±äº«çš„å¯¹ç§°å¯†é’¥ï¼Œç”¨äºåŠ å¯†åç»­çš„é€šä¿¡æ•°æ®ï¼Œå³ä½¿æ”»å‡»è€…æˆªè·äº†æ•°æ®ï¼Œä¹Ÿæ— æ³•è§£å¯†ã€‚
- **æ¶ˆæ¯å®Œæ•´æ€§**ï¼šè®°å½•åè®®ä½¿ç”¨æ¶ˆæ¯éªŒè¯ç ï¼ˆMACï¼‰æ¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œé˜²æ­¢æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹ã€‚

### 2. å£ä»¤å—…æ¢ï¼ˆPassword Sniffingï¼‰
å£ä»¤å—…æ¢æ˜¯æŒ‡æ”»å‡»è€…åœ¨ç½‘ç»œä¸­ç›‘å¬å¹¶æ•è·ç”¨æˆ·çš„å¯†ç ä¿¡æ¯ã€‚

**TLS/SSLè§£å†³æ–¹å¼ï¼š**
- **åŠ å¯†ä¼ è¾“**ï¼šæ¡æ‰‹åè®®åå•†å‡ºçš„å¯¹ç§°å¯†é’¥ç”¨äºåŠ å¯†åç»­çš„æ‰€æœ‰é€šä¿¡æ•°æ®ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„å¯†ç ã€‚åŠ å¯†åçš„æ•°æ®å³ä½¿è¢«æ”»å‡»è€…æˆªè·ï¼Œä¹Ÿæ— æ³•è§£å¯†ã€‚
- **å®‰å…¨æ¡æ‰‹**ï¼šé€šè¿‡æ¡æ‰‹åè®®ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åå•†å‡ºä¸€ä¸ªå®‰å…¨çš„ä¼šè¯å¯†é’¥ï¼Œç”¨äºåŠ å¯†åç»­çš„é€šä¿¡ï¼Œç¡®ä¿ä¼ è¾“çš„æœºå¯†æ€§ã€‚

### 3. IPåŠ«æŒï¼ˆIP Hijackingï¼‰
IPåŠ«æŒæ˜¯æŒ‡æ”»å‡»è€…é€šè¿‡ä¼ªé€ IPåœ°å€ï¼Œä½¿æ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«é”™è¯¯åœ°è·¯ç”±åˆ°æ”»å‡»è€…æ§åˆ¶çš„è®¾å¤‡ï¼Œä»è€Œæˆªè·æˆ–ç¯¡æ”¹æ•°æ®ã€‚

**TLS/SSLè§£å†³æ–¹å¼ï¼š**
- **èº«ä»½éªŒè¯**ï¼šé€šè¿‡æ•°å­—è¯ä¹¦éªŒè¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„èº«ä»½ï¼Œç¡®ä¿é€šä¿¡åŒæ–¹çš„åˆæ³•æ€§ï¼Œé¿å…æ”»å‡»è€…å†’å……åˆæ³•çš„é€šä¿¡æ–¹ã€‚
- **åŠ å¯†é€šä¿¡**ï¼šå³ä½¿æ”»å‡»è€…æˆåŠŸåŠ«æŒäº†IPåœ°å€ï¼ŒTLS/SSLçš„åŠ å¯†æœºåˆ¶ä»ç„¶å¯ä»¥ä¿æŠ¤æ•°æ®çš„æœºå¯†æ€§ï¼Œä½¿æ”»å‡»è€…æ— æ³•è§£å¯†æˆ–ç¯¡æ”¹æ•°æ®ã€‚
- **æ¶ˆæ¯å®Œæ•´æ€§**ï¼šç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ï¼Œå³ä½¿æ•°æ®åŒ…è¢«åŠ«æŒï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•ä¿®æ”¹æ•°æ®è€Œä¸è¢«å‘ç°ã€‚

### 4. æ•°æ®ç¯¡æ”¹ï¼ˆData Tamperingï¼‰
æ•°æ®ç¯¡æ”¹æ˜¯æŒ‡æ”»å‡»è€…åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæ‹¦æˆªå¹¶ä¿®æ”¹æ•°æ®å†…å®¹ã€‚

**TLS/SSLè§£å†³æ–¹å¼ï¼š**
- **æ¶ˆæ¯å®Œæ•´æ€§**ï¼šè®°å½•åè®®ä½¿ç”¨æ¶ˆæ¯éªŒè¯ç ï¼ˆMACï¼‰å’Œå“ˆå¸Œå‡½æ•°æ¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚ä»»ä½•ç¯¡æ”¹éƒ½ä¼šè¢«æ£€æµ‹åˆ°ï¼Œé˜²æ­¢æ”»å‡»è€…åœ¨ä¸è¢«å‘ç°çš„æƒ…å†µä¸‹ä¿®æ”¹æ•°æ®ã€‚
- **åŠ å¯†é€šä¿¡**ï¼šåŠ å¯†åçš„æ•°æ®æ— æ³•è¢«ç¯¡æ”¹è€Œä¸è¢«æ£€æµ‹åˆ°ï¼Œå› ä¸ºä»»ä½•ä¿®æ”¹éƒ½ä¼šå¯¼è‡´è§£å¯†å¤±è´¥æˆ–MACéªŒè¯å¤±è´¥ã€‚

### 5. é‡æ”¾æ”»å‡»ï¼ˆReplay Attackï¼‰
é‡æ”¾æ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…æˆªè·æ•°æ®åŒ…å¹¶åœ¨ä¹‹åé‡æ–°å‘é€è¿™äº›æ•°æ®åŒ…ï¼Œä»¥æ‰§è¡Œé‡å¤çš„æ“ä½œã€‚

**TLS/SSLè§£å†³æ–¹å¼ï¼š**
- **éšæœºæ•°å’Œä¼šè¯ID**ï¼šåœ¨æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç”Ÿæˆå¹¶äº¤æ¢éšæœºæ•°ï¼Œç”¨äºä¼šè¯å¯†é’¥çš„ç”Ÿæˆï¼Œç¡®ä¿æ¯æ¬¡ä¼šè¯éƒ½æ˜¯å”¯ä¸€çš„ã€‚
- **ä¼šè¯ç®¡ç†**ï¼šTLS/SSLä½¿ç”¨ä¼šè¯IDæ¥ç®¡ç†ä¼šè¯ï¼Œé˜²æ­¢é‡æ”¾æ”»å‡»ã€‚æ¯æ¬¡ä¼šè¯éƒ½æœ‰å”¯ä¸€çš„ä¼šè¯IDï¼Œé‡æ”¾æ—§çš„ä¼šè¯æ•°æ®ä¸ä¼šè¢«æ¥å—ã€‚

>   ä½¿ç”¨æŠ“åŒ…å·¥å…·Wiresharkåˆ†æHTTPSåè®®é€šä¿¡è¿‡ç¨‹ï¼ˆTLSç‰ˆæœ¬æœ€å¥½ä¸ºv1.2ï¼Œæ›´é«˜ç‰ˆæœ¬æ— æ³•æŸ¥çœ‹è¯ä¹¦è®¤è¯ç»†èŠ‚ï¼‰

1.   ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹TCPé“¾æ¥

     ![tcp-third-handshake](/Users/wwt13/Documents/Notes/assets/tcp-third-handshake.png)

2.   å®¢æˆ·ç«¯å‘é€Client Helloè¯·æ±‚ï¼šå®¢æˆ·ç«¯é€šè¿‡å‘é€"client hello"æ¶ˆæ¯å‘æœåŠ¡å™¨å‘èµ·æ¡æ‰‹è¯·æ±‚ï¼Œè¯¥æ¶ˆæ¯åŒ…å«äº†å®¢æˆ·ç«¯æ‰€æ”¯æŒçš„ TLS ç‰ˆæœ¬å’Œå¯†ç ç»„åˆä»¥ä¾›æœåŠ¡å™¨è¿›è¡Œé€‰æ‹©ï¼Œè¿˜æœ‰ä¸€ä¸ª"client random"éšæœºå­—ç¬¦ä¸²ã€‚

     ![https-tcp-client-hello](/Users/wwt13/Documents/Notes/assets/https-tcp-client-hello.png)

3.   æœåŠ¡ç«¯å“åº”Server Helloï¼šæœåŠ¡å™¨å‘é€"server hello"æ¶ˆæ¯å¯¹å®¢æˆ·ç«¯è¿›è¡Œå›åº”ï¼Œè¯¥æ¶ˆæ¯åŒ…å«äº†æ•°å­—è¯ä¹¦ï¼ŒæœåŠ¡å™¨é€‰æ‹©çš„å¯†ç ç»„åˆå’Œ"server random"éšæœºå­—ç¬¦ä¸²ã€‚

     ![https-tcp-server-hello](/Users/wwt13/Documents/Notes/assets/https-tcp-server-hello.png)

     å‘é€è¯ä¹¦ï¼š![https-tcp-certificate](/Users/wwt13/Documents/Notes/assets/https-tcp-certificate.png)

     æœ€ç»ˆServer Hello Done,ä»£è¡¨Server Helloç»“æŸ

4.   Client Key Exchangeï¼šå®¢æˆ·ç«¯éªŒè¯é€šè¿‡è¯ä¹¦åï¼Œå®¢æˆ·ç«¯å°†é‡‡ç”¨æœåŠ¡å™¨ç»™å‡ºçš„åŠ å¯†ç®—æ³•ä»¥åŠå…¬é’¥å°†åé¢ç”¨äºåŠ å¯†æ•°æ®çš„å¯¹ç§°å¯†é’¥è¿›è¡ŒåŠ å¯†å¹¶å‘é€ç»™æœåŠ¡å™¨![https-tcp-client-key-exchanger](/Users/wwt13/Documents/Notes/assets/https-tcp-client-key-exchanger.png)

5.   æ•°æ®ä¼ è¾“ï¼šç»è¿‡ä¹‹å‰6å¤§æ­¥éª¤ï¼ŒSSLçš„è¿æ¥å»ºç«‹å®Œæˆï¼Œå¼€å§‹æœ‰å®¢æˆ·ç«¯å‘èµ·Application Data

     ![https-tcp-data-transport](/Users/wwt13/Documents/Notes/assets/https-tcp-data-transport.png)