# 作业8

>   IPsec 协议是否能防止重放攻击？为什么？

可以，IPsec协议为每个数据包分配了一个唯一的序列号。接收方在收到数据包后，会检查其序列号是否已经出现过。如果序列号已经出现过，那么说明这是一个重放的数据包，将被丢弃。这样，IPsec就确保了每个数据包的唯一性，防止了重放攻击。

>   TLS/SSL协议由哪些协议构成？分别完成什么功能？

### 1. 握手协议 (Handshake Protocol)
握手协议是TLS/SSL的核心部分，用于在客户端和服务器之间建立安全连接。它主要完成以下功能：

- **身份验证**：通过数字证书验证服务器（有时也验证客户端）的身份。
- **密钥交换**：协商一个对称加密密钥，用于后续的数据加密。
- **协议协商**：确定使用的TLS/SSL版本和加密算法。
- **会话建立**：生成会话密钥，用于加密数据传输。

### 2. 记录协议 (Record Protocol)
记录协议负责将数据分割成合适的大小，并对数据进行加密和完整性保护。它主要完成以下功能：

- **数据分割**：将应用层传输的数据分割成适合大小的记录。
- **压缩**：（可选）对数据进行压缩以减少传输数据量。
- **加密**：使用协商好的对称密钥对数据进行加密。
- **完整性保护**：生成消息验证码（MAC）以确保数据在传输过程中未被篡改。

### 3. 报警协议 (Alert Protocol)
报警协议用于在客户端和服务器之间传递警报消息，通知对方发生了某些事件。警报消息可以是警告或致命错误。它主要完成以下功能：

- **警告**：通知对方一些非致命错误或事件（如即将关闭连接）。
- **致命错误**：通知对方发生了致命错误，连接将被终止（如证书验证失败、解密失败等）。

### 4. 变更密码规范协议 (Change Cipher Spec Protocol)
变更密码规范协议是一个非常简单的协议，用于通知对方在后续通信中将使用新的加密算法和密钥。它主要完成以下功能：

- **密码规范变更**：通知对方从此刻起使用新的加密参数（如会话密钥和加密算法）。

### 5. 应用数据协议 (Application Data Protocol)
应用数据协议用于传输应用层的数据。它主要完成以下功能：

- **数据传输**：在建立安全连接后，传输加密和完整性保护的应用层数据（如HTTP请求和响应）。

>   SSL连接和SSL会话之间有什么不同？

-   连接：提供合适服务类型的传输。
    -   特点：连接是对等的，暂时的和关联的(指和会话）

-   会话： 是服务器和客户端的关联

如下图👇🏻

![124824239](/Users/wwt13/Documents/Notes/assets/124824239.webp)

>   考虑Web的安全威胁，如中间人攻击，口令嗅探、IP劫持等，结合TLS/SSL协议的特点说明每个威胁是如何解决的？

### 1. 中间人攻击（Man-in-the-Middle Attack, MITM）
中间人攻击是指攻击者在客户端和服务器之间拦截和篡改通信内容，从而获取敏感信息或操纵数据。

**TLS/SSL解决方式：**
- **数字证书和身份验证**：在握手过程中，服务器会向客户端提供数字证书，客户端验证证书的合法性，确保服务器的身份真实。若证书无效或不可信，客户端会终止连接。
- **加密通信**：握手协议协商出共享的对称密钥，用于加密后续的通信数据，即使攻击者截获了数据，也无法解密。
- **消息完整性**：记录协议使用消息验证码（MAC）来保证数据的完整性，防止数据在传输过程中被篡改。

### 2. 口令嗅探（Password Sniffing）
口令嗅探是指攻击者在网络中监听并捕获用户的密码信息。

**TLS/SSL解决方式：**
- **加密传输**：握手协议协商出的对称密钥用于加密后续的所有通信数据，包括用户的密码。加密后的数据即使被攻击者截获，也无法解密。
- **安全握手**：通过握手协议，客户端和服务器协商出一个安全的会话密钥，用于加密后续的通信，确保传输的机密性。

### 3. IP劫持（IP Hijacking）
IP劫持是指攻击者通过伪造IP地址，使数据包在传输过程中被错误地路由到攻击者控制的设备，从而截获或篡改数据。

**TLS/SSL解决方式：**
- **身份验证**：通过数字证书验证服务器和客户端的身份，确保通信双方的合法性，避免攻击者冒充合法的通信方。
- **加密通信**：即使攻击者成功劫持了IP地址，TLS/SSL的加密机制仍然可以保护数据的机密性，使攻击者无法解密或篡改数据。
- **消息完整性**：确保数据在传输过程中未被篡改，即使数据包被劫持，攻击者也无法修改数据而不被发现。

### 4. 数据篡改（Data Tampering）
数据篡改是指攻击者在数据传输过程中，拦截并修改数据内容。

**TLS/SSL解决方式：**
- **消息完整性**：记录协议使用消息验证码（MAC）和哈希函数来确保数据的完整性。任何篡改都会被检测到，防止攻击者在不被发现的情况下修改数据。
- **加密通信**：加密后的数据无法被篡改而不被检测到，因为任何修改都会导致解密失败或MAC验证失败。

### 5. 重放攻击（Replay Attack）
重放攻击是指攻击者截获数据包并在之后重新发送这些数据包，以执行重复的操作。

**TLS/SSL解决方式：**
- **随机数和会话ID**：在握手过程中，客户端和服务器生成并交换随机数，用于会话密钥的生成，确保每次会话都是唯一的。
- **会话管理**：TLS/SSL使用会话ID来管理会话，防止重放攻击。每次会话都有唯一的会话ID，重放旧的会话数据不会被接受。

>   使用抓包工具Wireshark分析HTTPS协议通信过程（TLS版本最好为v1.2，更高版本无法查看证书认证细节）

1.   三次握手建立TCP链接

     ![tcp-third-handshake](/Users/wwt13/Documents/Notes/assets/tcp-third-handshake.png)

2.   客户端发送Client Hello请求：客户端通过发送"client hello"消息向服务器发起握手请求，该消息包含了客户端所支持的 TLS 版本和密码组合以供服务器进行选择，还有一个"client random"随机字符串。

     ![https-tcp-client-hello](/Users/wwt13/Documents/Notes/assets/https-tcp-client-hello.png)

3.   服务端响应Server Hello：服务器发送"server hello"消息对客户端进行回应，该消息包含了数字证书，服务器选择的密码组合和"server random"随机字符串。

     ![https-tcp-server-hello](/Users/wwt13/Documents/Notes/assets/https-tcp-server-hello.png)

     发送证书：![https-tcp-certificate](/Users/wwt13/Documents/Notes/assets/https-tcp-certificate.png)

     最终Server Hello Done,代表Server Hello结束

4.   Client Key Exchange：客户端验证通过证书后，客户端将采用服务器给出的加密算法以及公钥将后面用于加密数据的对称密钥进行加密并发送给服务器![https-tcp-client-key-exchanger](/Users/wwt13/Documents/Notes/assets/https-tcp-client-key-exchanger.png)

5.   数据传输：经过之前6大步骤，SSL的连接建立完成，开始有客户端发起Application Data

     ![https-tcp-data-transport](/Users/wwt13/Documents/Notes/assets/https-tcp-data-transport.png)