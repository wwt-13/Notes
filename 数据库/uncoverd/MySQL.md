#Database/MySQL

> Only record what I need to know and what I'am not so familar with.

## æ‚

> è¿™é‡Œæ”¾çš„æ˜¯ä¸çŸ¥é“è¯¥å¦‚ä½•å½’ç±»çš„MySQLå†…å®¹ï¼ŒåŒ…æ‹¬äº†ä¸€äº›çº¦å®šä¿—ç§°çš„åŸºç¡€ç­‰ç­‰

1. å‘½ä»¤é»˜è®¤ä»¥;æˆªæ­¢[^1]
2. æ•°æ®åº“å+==è¡¨å==éƒ½ä¸æ”¯æŒå¤§å†™ï¼ˆ==ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå°å†™ï¼Œä½†å¯èƒ½æŒ‰ç…§å¤§å†™æ˜¾ç¤º==ï¼‰ï¼Œä½†æ˜¯å­—æ®µåæ”¯æŒå¤§å†™
3. ä¸¤ç§æ³¨é‡Šæ ¼å¼ï¼š`#`(å¸¸ç”¨) ` --  `
4. åœ¨å‘½ä»¤æœ«å°¾åŠ ä¸Š`\G`,å¯ä»¥æ‰“æ‰“æ”¹å–„æŸäº›æŒ‡ä»¤çš„æ˜¾ç¤ºæ•ˆæœ(_åŸç†æ˜¯å°†æŸ¥è¯¢ç»“æœä»é»˜è®¤çš„æŒ‰è¡Œæ‰“å°åˆ‡æ¢ä¸ºæŒ‰åˆ—æ‰“å°_)

### æŠ¥é”™å¤„ç†

> é‰´äºMySQLç¦»è°±çš„æŠ¥é”™æœºåˆ¶ï¼ˆå¾€å¾€ä¸€å¤„è¯­æ³•é”™è¯¯ä¼šæŠ¥å‡ºå¦å¤–ä¸€ä¸ªé£ç‰›é©¬ä¸ç›¸åŠçš„æŠ¥é”™æç¤ºï¼‰ï¼Œæ‰€ä»¥è¿›è¡Œå¸¸è§çš„æŠ¥é”™æ•´ç†æ˜¯éå¸¸æœ‰å¿…è¦çš„

### æ•°æ®ç±»å‹

> å…³ç³»ä»£æ•°ä¸­çš„å±æ€§ç±»å‹ï¼Œåœ¨MySQLä¸­ï¼Œå°±æ˜¯æ•°æ®åº“ä¸‹è¡¨ä¸­çš„å­—æ®µç±»å‹
> psï¼šMySQLä¸­ï¼Œå®šä¹‰ä¸€ä¸ªå­—æ®µç±»å‹çš„åŸºæœ¬è¯­æ³•ï¼ˆ`col_name date_type constraint`ï¼‰

1. æ•°å€¼å‹
   - æ•´å‹ $tinyint,smallint,mediumint,int,bigint$
   - æµ®ç‚¹å‹ $float,double,dccimal(M,D)$
     _M,D_åˆ†åˆ«ä»£è¡¨æµ®ç‚¹æ•°é•¿åº¦ï¼ˆä¸åŒ…æ‹¬å°æ•°ç‚¹å’Œç¬¦å·ï¼‰ï¼Œå’Œå°æ•°ç‚¹åä½æ•°
     æ¯”è¾ƒå¸¸ç”¨çš„ä¸€èˆ¬åªæœ‰`int`å’Œ`float`
   
   | ç±»å‹      | å­—èŠ‚æ•° |
   | --------- | ------ |
   | tinyint   | 1      |
   | smallint  | 2      |
   | mediunint | 3      |
   | int       | 4      |
   | bigint    | 8      |
   
2. å­—ç¬¦å‹
   ä¸€èˆ¬å¸¸ç”¨çš„åªæœ‰$char$å’Œ$varchar$,äºŒè€…åŒºåˆ«æ˜¯`char(10)`å¼€è¾Ÿå‡ºçš„å­˜å‚¨ç©ºé—´æ˜¯å›ºå®šçš„10ä¸ªå­—ç¬¦ï¼Œè€Œ`varchar(10)`åˆ™åœ¨å¼€è¾Ÿæ˜¯ä¸ºç©ºï¼Œåç»­å†æ ¹æ®å­˜æ”¾å†…å®¹è‡ªåŠ¨åˆ†é…ç©ºé—´(charè¿½æ±‚æ—¶é—´æ•ˆç‡ï¼Œvarcharè¿½æ±‚ç©ºé—´æ•ˆç‡)
3. æ—¥æœŸæ—¶é—´å‹
4. æšä¸¾å‹(ç”¨äºç»™å­—æ®µæŒ‡å®šä¸€ä¸ªç‰¹å®šèŒƒå›´)
   `enum(value1,value2,value3......)`
5. å¸ƒå°”å‹
   mysqlä¸­æ²¡æœ‰å†…ç½®çš„å¸ƒå°”ç±»å‹ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼ŒMYSQLæä¾›`boolean`ä½œä¸º`tinyint(1)`çš„åŒä¹‰è¯ï¼Œå…¶ä¸­0ä¸ºfalse,1ä¸ºtrue
   > [!hint] å…³äºTRUEã€FALSEå’ŒUNKNOWN
   > åœ¨mysqlä¸­ï¼ŒWhereè¯­å¥ä¸­çš„æ¡ä»¶è¡¨è¾¾å¼æœ‰ä¸‰ç§å¯èƒ½çš„è®¡ç®—ç»“æœï¼štrue,false,unknown
   > ä¸‰è€…å‡å¯é€šè¿‡æ•°å€¼æ¥ä»£æ›¿ï¼štrue=1,false=0,unknown=0.5

```sql
create table if not exists tb1(
   id int auto_increment,
   name char(10) not null,
   gender enum('male','female'),
   passed boolean default false, 
   primary key(id) # éœ€è¦æ³¨æ„çš„æ˜¯æœ€åä¸€è¡Œä¸éœ€è¦,
);
```

## åŸºæœ¬MySQLè¯­æ³•

> è®²è§£æœ€ä¸ºåŸºç¡€çš„SQLè¯­æ³•

### æ•°æ®åº“æ“ä½œ

> æ•°æ®åº“å±‚çº§çš„åŸºæœ¬æ“ä½œè¯­æ³•(å› ä¸ºæ•°é‡ä¸å¤šï¼Œæ‰€ä»¥ç›´æ¥ä»¥åˆ—è¡¨å½¢å¼å±•ç¤º)

1. `show databases;`æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“(æ³¨æ„**s**)
2. `create database db_name;`åˆ›å»ºæ•°æ®åº“
3. `use db_name;`ä½¿ç”¨æ•°æ®åº“ï¼ˆæ“ä½œç¯å¢ƒå˜æ›´ä¸ºè¯¥æ•°æ®åº“ä¸‹çš„è¡¨ï¼‰
4. `drop database db_name;`åˆ é™¤æ•°æ®åº“

### è¡¨æ“ä½œ

> è¡¨å±‚çº§çš„åŸºæœ¬æ“ä½œè¯­æ³•

1. `show tables;`æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨
2. `select * from tb_name;`æŸ¥çœ‹è¡¨ä¸­çš„æ‰€æœ‰å†…å®¹
3. `drop table tb_name;`åˆ é™¤è¡¨

### Constraints

> çº¦æŸæ˜¯ä¸€ç§é™åˆ¶ï¼Œå¯¹è¡¨çš„è¡Œå’Œåˆ—çš„æ•°æ®è¿›è¡Œé™åˆ¶ï¼Œç”¨äºç¡®ä¿è¡¨ä¸­æ•°æ®çš„å®Œæ•´æ€§å’Œå”¯ä¸€æ€§ï¼Œæ¯”æ–¹è¯´é™åˆ¶äººçš„å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°ç­‰ç­‰
> çº¦æŸä¸€èˆ¬åœ¨è¡¨åˆ›å»ºçš„æ—¶å€™æ·»åŠ ï¼Œæˆ–è€…åœ¨è¡¨åˆ›å»ºå®Œæˆåé€šè¿‡`alter`è¯­å¥è¿›è¡Œä¿®æ”¹

åŸºæœ¬ä½¿ç”¨å½¢å¼ï¼š`col_name col_type constraint`(æŒ‡åˆ›å»ºè¡¨æ—¶)

_**åŸºæœ¬ä¹¦å†™è§„èŒƒ**_ğŸ‘‡ğŸ»

```sql
CREATE TABLE è¡¨å(
    å­—æ®µå å­—æ®µç±»å‹ åˆ—çº§çº¦æŸ,
    å­—æ®µå å­—æ®µç±»å‹,
    è¡¨çº§çº¦æŸ # æ³¨æ„åˆ—çº§çº¦æŸå’Œè¡¨çº§çº¦æŸçš„ä½ç½®
)
```

- `default`ï¼šé»˜è®¤çº¦æŸï¼ŒæŒ‡å®šæŸåˆ—çš„**é»˜è®¤å€¼**ï¼Œæ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœæ­¤åˆ—æœªèµ‹å€¼ï¼Œåˆ™ä½¿ç”¨defaultæŒ‡å®šçš„å€¼æ¥å¡«å……
  ```sql
  name varchar(10) default 'wwt'
  ```
- `not null`: éç©ºçº¦æŸï¼ŒæŒ‡å®šæŸåˆ—çš„å€¼**ä¸èƒ½ä¸ºç©º**ï¼Œåœ¨æ’å…¥æ•°æ®çš„æ—¶å€™å¿…é¡»æŒ‡å®šï¼Œ ''ä¸ç­‰äº null, 0ä¸ç­‰äº null
- `unique`ï¼šå”¯ä¸€çº¦æŸï¼Œä½†ä¸ç­‰åŒäº`primary key`
  - æŒ‡å®š**åˆ—**æˆ–**åˆ—ç»„åˆ**å”¯ä¸€ï¼Œä¿è¯æ•°æ®å”¯ä¸€æ€§
  - ä¸èƒ½å‡ºç°é‡å¤å€¼ï¼Œä½†æ˜¯å¯ä»¥å‡ºç°å¤šä¸ªNULL
  - _åŒä¸€å¼ è¡¨å¯ä»¥å­˜åœ¨å¤šä¸ªå”¯ä¸€çº¦æŸ_
  > [!todo]
  > å¯¹äºuniqueç›¸å…³çš„çŸ¥è¯†å°†åœ¨_**ç´¢å¼•**_ç« èŠ‚å…·ä½“ä»‹ç»ï¼Œè¿™é‡Œåªæ˜¯è¿›è¡Œç²—ç•¥äº†è§£
- _`primary key`_: ==ä¸»é”®çº¦æŸ==
  **ç­‰ä»·äºå”¯ä¸€çº¦æŸ+éç©ºçº¦æŸ**
  **æ³¨æ„ï¼Œä¸»é”®ç­‰ä»·äºå…³ç³»ä»£æ•°çš„ä¸»ç ï¼Œå¯èƒ½ä¸æ­¢ä¸€ä¸ªå­—æ®µ**
  **å¦‚æœå»ºè¡¨æ—¶æœªå»ºä¸»é”®ï¼Œmysqlä¼šè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªå”¯ä¸€éç©ºå­—æ®µä½œä¸ºä¸»é”®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šå†…å»ºä¸€ä¸ªä¸å¯è§å­—æ®µä½œä¸ºä¸»é”®**
- `foreign key`ï¼šå¤–é”®çº¦æŸ
  - é€šè¿‡å»ºç«‹å¤–é”®ï¼Œè®¾ç½®è¡¨ä¸è¡¨ä¹‹é—´çš„çº¦æŸæ€§ï¼Œé™åˆ¶æ•°æ®çš„å½•å…¥,è¢«å¤–é”®çº¦æŸçš„åˆ—ï¼Œ_**è¦ä¹ˆä¸ºnullï¼Œè¦ä¹ˆå–å€¼å¿…é¡»å‚ç…§ä¸»è¡¨åˆ—ä¸­çš„å€¼**_
  - _**å¤–é”®çº¦æŸçš„åˆ—ç±»å‹å¿…é¡»å’ŒåŸè¡¨ä¸»é”®ç±»å‹å®Œå…¨ä¸€è‡´**_ï¼ˆæ¯”å¦‚`unsigned`ç­‰ç­‰ï¼‰
  ```sql
  create table dept(
      id int unsigned auto_increment,
      primary key(id)
  );
  create table tb_test(
      id int auto_increment,
      name varchar(10) not null,
      d_no int default 0,
      primary key(id),
      foreign key(d_no) references dept(id)
  );
  # åˆ›å»ºæ•°æ®è¡¨tb_testæ—¶ä¼šæŠ¥é”™"...are incompatible."
  # æ•°æ®æ ¼å¼ä¸åŒ¹é…(d_noåŒæ ·éœ€è¦unsigned,ä½†æ˜¯defaultè²Œä¼¼æ²¡æœ‰å½±å“ï¼Ÿ)
  create table tb_test(
      id int auto_increment,
      name varchar(10) not null,
      d_no int unsigned default 0,
      primary key(id),
      foreign key(d_no) references dept(id)
  );
  # success
  ```
- `auto_increment`ï¼šè‡ªå¢é•¿çº¦æŸ
  - è‡ªå¢é•¿çš„å¿…é¡»æ˜¯**é”®**(å¿…é¡»æœ‰keyçº¦æŸ)ï¼Œä½†ä¸ä¸€å®šæ˜¯éå¾—æ˜¯ä¸»é”®
  - ==ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªè‡ªå¢é•¿çº¦æŸ==
- `check`ï¼šè‡ªå®šä¹‰çº¦æŸ
  ä½¿ç”¨æ–¹å¼ä¸ºï¼š`check+è¡¨è¾¾å¼`ï¼Œå¯ä»¥å¯¹åˆ—å•ç‹¬æ·»åŠ çº¦æŸï¼Œä¹Ÿå¯ä»¥åˆ—ç›´æ¥æ·»åŠ çº¦æŸï¼Œä¸‹é¢ç›´æ¥çœ‹ä¾‹å­â¬‡ï¸
  ```sql
  create table if not exist test_tb(
      id int unsigned auto_increment,
      tid int,
      sid int not null check(sid>10),
      check(tid>sid and tid<100),
      primary key(id)
  );
  ```
  ^d28ee7

> [!note] æ‹“å±•ï¼šå¤–é”®çº§è”æ“ä½œ
>
> 1. `on delete cascade`ï¼šåˆ é™¤ä¸»è¡¨ä¸­çš„æ•°æ®æ—¶ï¼Œä»è¡¨ä¸­çš„æ•°æ®éšä¹‹åˆ é™¤
> 2. `on update cascase`ï¼šæ›´æ–°ä¸»è¡¨ä¸­çš„æ•°æ®æ—¶ï¼Œä»è¡¨ä¸­çš„æ•°æ®éšä¹‹æ›´æ–°
> 3. `on delete set null`ï¼šåˆ é™¤ä¸»è¡¨ä¸­çš„æ•°æ®æ—¶ï¼Œä»è¡¨ä¸­çš„æ•°æ®ç½®ç©º
>
> ä½¿ç”¨èŒƒä¾‹ï¼š`FOREIGN KEY (sid) REFERENCES stu(sid) ON DELETE CASCADE ON UPDATE CASCADE)`

#### æŸ¥çœ‹çº¦æŸ

> ä¸¤ç§æ–¹æ³•ï¼Œä¸ªäººæ¨èç¬¬äºŒç§

1. `desc tb_name`åŒæ—¶è¿˜èƒ½æŸ¥çœ‹è¡¨ç»“æ„ï¼ˆè™½ç„¶è¿™æ¡å‘½ä»¤æœ¬æ¥çš„åŠŸèƒ½å°±æ˜¯æŸ¥çœ‹è¡¨ç»“æ„ï¼‰
   ![[CleanShot 2023-02-22 at 19.47.55.png]]
2. `show create table tb_name`å¯ä»¥ç›´æ¥æŸ¥çœ‹**å½“å‰çš„**è¡¨è¯­æ³•ç»“æ„_(æ¨èä¸`\G`ç»“åˆä½¿ç”¨)_
   ![[CleanShot 2023-03-09 at 15.46.25.png]]

### è¡¨åŸºæœ¬æ“ä½œ

> åˆ›å»ºã€åˆ é™¤è¡¨ç­‰åœ¨å…³ç³»å±‚é¢çš„æ“ä½œ

1. åˆ›å»ºï¼š`create table [if not exists] tb_name(col_name col_type ...)`
   ```mysql
   create table if not exists tb2(
       id int unsigned auto_increment,
       name varchar(10) default "name",
       primary key(id)
   ); # æ³¨æ„æˆªæ­¢ç¬¦
   ```
   > [!attention] è¯´æ˜
   > æœ‰å…³çº¦æŸéƒ¨åˆ†çš„å†…å®¹å°†åœ¨ä¹‹åè¿›è¡Œè¯¦ç»†è¯´æ˜(primary key,unsignedä¹‹ç±»çš„)
2. åˆ é™¤ï¼š`drop table [if exists] tb_name`

#### alterè¯­å¥

> é€šç”¨çš„è¡¨ä¿®æ”¹è¯­å¥ï¼Œå¯ä»¥å¯¹è¡¨è¿›è¡Œåˆ—åˆ é™¤ã€åˆ—æ·»åŠ ã€çº¦æŸä¿®æ”¹ã€é‡å‘½åç­‰ç­‰æ“ä½œ
> å…³é”®åœ¨ä¸å­¦äº†alteråï¼Œå°±ä¸ç”¨å­¦ä¹ å…¶ä»–éé€šç”¨çš„è¡¨ä¿®æ”¹è¯­å¥äº†ï¼ˆé˜²æ­¢è®°å¿†æ··ä¹±ï¼‰

```sql
# å®éªŒè¡¨ï¼Œç”¨äºæµ‹è¯•alterè¯­å¥
create table stu(
	id int not null, 
	name char(10) not null, 
	class int not null, 
	age int,
	primary key(id) 
);
```

1. åˆ é™¤åˆ—ï¼š`alter table tb_name drop col_name;`
2. æ·»åŠ åˆ—ï¼š`alter tale tb_name add col_name constraint`
3. ä¿®æ”¹åˆ—ï¼š`alter table tb_name modify col_name constraint`
4. è¡¨é‡å‘½åï¼š`alter table tb_name rename tb_name2`
5. æ·»åŠ çº¦æŸï¼š`alter table tb_name add constriant field_name constriant_type`
6. åˆ é™¤çº¦æŸï¼š`alter table tb_name drop constraint`

### æ•°æ®æŸ¥è¯¢

> ä»æ•°æ®åº“ä¸­è·å–æŒ‡å®šçš„æ•°æ®ï¼Œè¿™æ˜¯æ•°æ®åº“ç®¡ç†æŠ€æœ¯ä¸­çš„**æ ¸å¿ƒæ“ä½œ**

åŸºæœ¬æŸ¥è¯¢æµç¨‹å¦‚ä¸‹ğŸ‘‡ğŸ»

```sql
select å­—æ®µ # æŒ‡å®šäº†è¦æ˜¾ç¤ºçš„å±æ€§åˆ—
from table_names # æŒ‡å®šæŸ¥è¯¢å¯¹è±¡(å¯èƒ½æ‰§è¡Œè¡¨è¿æ¥æ“ä½œç­‰ç­‰)
where conditions about tuples of the tables # æŒ‡å®šæŸ¥è¯¢æ¡ä»¶
group by one or more attributes # å¯¹æŸ¥è¯¢ç»“æœæŒ‰ç…§åˆ—çš„å€¼è¿›è¡Œåˆ†ç»„ï¼ˆåˆ†ç»„ä¾æ®ä¸ºé›†å‡½æ•°ä½œç”¨çš„å€¼ï¼‰
having attributes # ç­›é€‰å‡ºæ»¡è¶³æ¡ä»¶çš„ç»„
order by one or more attributes; # å¯¹æŸ¥è¯¢ç»“æœæŒ‰ç…§æŒ‡å®šåˆ—å€¼è¿›è¡Œå‡åºé™åºæ’åˆ—
```

^f25911

#### SQLæŸ¥è¯¢è¯­å¥æ‰§è¡Œé¡ºåº

> å’Œå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸åŒï¼Œ_sqlçš„æŸ¥è¯¢è¯­å¥å¹¶ä¸æ˜¯é¡ºåºæ‰§è¡Œçš„_

![[MySQL#^f25911]]

1. `from`è¯­å¥ç»„è£…æ¥è‡ªä¸åŒæ•°æ®æºçš„æ•°æ®->==é¦–å…ˆè·å–åˆ°æŸ¥è¯¢æ€»è¡¨==
2. `where`è¯­å¥åŸºäºæ‰§è¡Œæ¡ä»¶å¯¹è®°å½•è¡Œè¿›è¡Œç­›é€‰->å¯¹è·å–åˆ°çš„æ•°æ®è¿›è¡Œ==åˆæ­¥ç­›é€‰==
3. `group by`è¯­å¥å°†åˆæ­¥ç­›é€‰åçš„æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†ç»„->==å¯¹æ•°æ®æŒ‰ç…§ä¾æ®åˆ—è¿›è¡Œåˆ†ç»„==ï¼Œå¦‚æœä½¿ç”¨äº†`group by`ï¼Œé‚£ä¹ˆ==åç»­æ­¥éª¤å¾—åˆ°çš„æ•°æ®éƒ½åªèƒ½æ˜¯åˆ†ç»„ä¾æ®åˆ—å’Œèšåˆå‡½æ•°å€¼==
4. `select`å¯¹æœ€ç»ˆæ˜¾ç¤ºçš„æ•°æ®åˆ—è¿›è¡Œé€‰æ‹©->é€‰å‡ºæ•°æ®åˆ—ï¼Œå¦‚æœä¹‹å‰ä½¿ç”¨äº†`group by`åˆ™`select`å­—å¥ä¹Ÿ**åªèƒ½åŒ…å«åˆ†ç»„ä¾æ®åˆ—å’Œèšåˆå‡½æ•°**
5. `having`è¯­å¥å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç­›é€‰->==ç±»ä¼¼`where`ï¼Œä½†ä½œç”¨å¯¹è±¡æ˜¯ç»„==ï¼ŒåŒç†ï¼Œåœ¨`having`è¯­å¥ä¸­å‡ºç°çš„==åªèƒ½æ˜¯ä½œä¸ºåˆ†ç»„ä¾æ®çš„åˆ—æˆ–è€…èšé›†å‡½æ•°==
6. `order by`å¯¹ç»“æœè¿›è¡Œæ’åº->æ’åº

> [!important] é‡è¦
> è¯¥éƒ¨åˆ†å†…å®¹å¿…é¡»ç†Ÿè®°äºå¿ƒ

#### å•è¡¨æŸ¥è¯¢

> é¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯ä»…æ¶‰åŠä¸€ä¸ªè¡¨çš„æŸ¥è¯¢æ“ä½œï¼Œç›¸å¯¹ç®€å•(å…¶å®å°±æ˜¯`from`è¯­å¥ä¸­ä¸æ¶‰åŠç±»ä¼¼`join`çš„è¡¨è¿æ¥æ“ä½œ)

è¡¨æŸ¥è¯¢å®ä¾‹æ¨¡å‹ğŸ‘‡ğŸ»

- å­¦ç”Ÿè¡¨`Stu(Sno,Sname,Ssex,Sage,Sdept)`
- è¯¾ç¨‹è¡¨`Co(Cno,Cname,Cpno,Ccredit)`
- å­¦ç”Ÿé€‰è¯¾è¡¨`SC(Sno,Cno,Grade)`

```sql
# è¡¨åˆ›å»ºè„šæœ¬
create table Stu(
	Sno int auto_increment,
	Sname char(10) not null,
	Ssex enum('male','female'),
	Sage int default 18,
	Sdept char(10),
	check(Sage>0 and Sage<200),
	primary key(Sno)
);
create table Co(
	Cno int auto_increment,
	Cname char(10) not null,
	Cpno int,
	Ccredit float(2,1),
	primary key(Cno,Cpno)
);
create table SC(
	Sno int,
	Cno int,
	Grade int default 0,
	primary key(Sno,Cno),
	foreign key(Sno) references Stu(Sno),
	foreign key(Cno) references Co(Cno)
);
# ç»è¿‡éªŒè¯ï¼Œä¸Šè¯‰ä¸‰è¡¨å‡å¯åˆ›å»ºæˆåŠŸ
insert into Stu(Sname,Ssex,Sage,Sdept)
values
("å°ç‹",'male',17,'Math'),
("å°ç»¿",'female',18,'Software'),
("å°ç¾",'female',17,'Physics'),
("å°ä½",'male',19,'Math'),
("å°é˜¿",'male',17,'Sofeware');
```

^4fa73c

![[CleanShot 2023-03-09 at 16.33.40.png]]
æ•°æ®æ’å…¥æˆåŠŸğŸ‘†ğŸ»

##### æŸ¥è¯¢ç»è¿‡ä¿®æ”¹çš„å€¼

> `select`æŸ¥è¯¢è¯­å¥åçš„å­—æ®µå¯ä»¥ç»è¿‡_è¡¨è¾¾å¼è®¡ç®—_ã€_é‡å‘½å_ã€_å†…ç½®å‡½æ•°_åä½œä¸ºç»“æœè¡¨ä¸­çš„å€¼
> è¯¥éƒ¨åˆ†å†…å®¹æ¯”è¾ƒç®€å•ï¼Œä¸¾ä¸ªä¾‹å­å°±è¡Œäº†

```sql
# æŸ¥è¯¢å…¨ä½“å­¦ç”Ÿçš„å‡ºç”Ÿå¹´ä»½,å§“åå’Œå°å†™ä¸“ä¸šå
select Sname,2023-Sage as 'Year of Birth',lower(Sdept) from stu
```

> [!note] distinct
> æœ‰æ—¶æŸ¥è¯¢å¾—åˆ°çš„è¡¨ä¼šåŒ…å«é‡å¤çš„å…ƒç»„ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡`distinct`æ¥æ¶ˆé™¤é‡å¤è¡Œ
>
> ```sql
> select distinct Sname,Sage from Stu;
> ```
>
> éœ€è¦æ³¨æ„çš„æ˜¯`distinct`ä½œç”¨äºæ‰€æœ‰åˆ—

##### whereè¯­å¥æŸ¥è¯¢æ¡ä»¶

> ç®€å•ï¼Œè¿™é‡ŒåªæåŠä¸€ä¸‹`like`éƒ¨åˆ†çš„å†…å®¹

![[CleanShot 2023-03-09 at 16.49.00.png]]

- `where attribute like pattern`
  1. `%`ä»£è¡¨ä»»æ„é•¿åº¦çš„å­—ç¬¦ä¸²
  2. `_`ä»£è¡¨ä»»æ„å•ä¸ªå­—ç¬¦
  3. **å¦‚æœç”¨æˆ·æŸ¥è¯¢ç»“æœä¸­æœ¬èº«åŒ…å«äº†`%`æˆ–`_`ï¼Œå¯ä»¥é€šè¿‡`escape`æŒ‡å®šç‰¹å®šè½¬ä¹‰å­—ç¬¦**

_**Now use some example to explain things above.**_

```sql
# 1
select * from Stu
where Sage>18;
# 2
select * from Stu
where Sage between 15 and 20;
# 3
select * from Stu
where Sdept in ('Math','Software');
# 4:æŸ¥æ‰¾ä¸å­¦æ•°å­¦çš„å§“ç‹çš„åŒå­¦
select Sname,Sage,Sdept from Stu
where Sname like 'ç‹%' and Sdept not like 'Ma__';
# 5:æŸ¥è¯¢ä»¥â€œDB_â€å¼€å¤´ï¼Œä¸”å€’æ•°ç¬¬3ä¸ªå­—ç¬¦ä¸º i çš„è¯¾ç¨‹ çš„è¯¦ç»†æƒ…å†µ
select * from Stu
where Sdept like 'DB*_%i__'
escape '*'
```

##### ç»“æœæ’åº

> ä½¿ç”¨`order by`å­å¥å¯ä»¥å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åºï¼ŒåŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼š`order by field asc/desc`
> _**psï¼šé»˜è®¤æ’åºæ–¹å¼ä¸ºå‡åºasc**_

```sql
select * from Stu
where Sdept="Math"
order by Sage desc;
```

##### åˆ†ç»„å’Œèšé›†

> _**é€šè¿‡`group by`è¯­å¥å¯ä»¥å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œåˆ†ç»„**ï¼Œ**åˆ†ç»„åï¼Œèšé›†å‡½æ•°çš„ä½œç”¨å¯¹è±¡å°†åˆ‡æ¢ä¸ºå„ä¸ªåˆ†ç»„ï¼Œ==åˆ†ç»„çš„ä½œç”¨å°±æ˜¯ç»†åŒ–èšé›†å‡½æ•°çš„ä½œç”¨å¯¹è±¡==**_
> åœ¨`select`è¯­å¥ä¸­å¯ä»¥ä½¿ç”¨èšé›†å‡½æ•°ï¼Œå¯¹æŒ‡å®šçš„åˆ—è¿›è¡Œèšé›†è®¡ç®—ï¼ˆSUMã€AVEã€COUNTç­‰ç­‰ï¼‰

å¸¸è§çš„èšé›†å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºğŸ‘‡ğŸ»

- `COUNT([DISTINCT|ALL] COL_NAME|*)`è®¡æ•°å‡½æ•°
- `SUM([DISTINCT|ALL] COL_NAME)`æ±‚å’Œå‡½æ•°
- `AVG([DISTINCT|ALL] COL_NAME)`å–å¹³å‡å‡½æ•°
- `MAX([DISTINCT|ALL] COL_NAME)`æœ€å¤§å€¼
- `MIN([DISTINCT|ALL] COL_NAME)`æœ€å°å€¼

> [!hint]
> ç©ºå€¼ä¸ä¼šåŠ å…¥COUNTã€SUMã€AVGç­‰å‡½æ•°çš„è®¡ç®—ï¼Œ`avg(Sage)=sum(Sage)/count(Sage)`

```sql
select Sdept,avg(Sage)
from stu
group by Sdept;
```

##### åˆ†ç»„ç­›é€‰

> é€šè¿‡`having`è¯­å¥å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç­›é€‰ï¼Œå’Œ`where`è¯­å¥ç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯ä½œç”¨å¯¹è±¡

```sql
select Sdept,avg(Sage) 
from stu group by Sdept 
having count(*)>1
```

#### å¤šè¡¨æŸ¥è¯¢

##### è¿æ¥æ–¹å¼ä»‹ç»

> åœ¨`from`è¯­å¥ä¸­ï¼Œå¯ä»¥è¿›è¡Œå…³ç³»ä»£æ•°ä¸­è¿›è¡Œå„ç§è¿æ¥æ“ä½œï¼ˆç¬›å¡å°”ç§¯ã€å†…è¿æ¥ã€$\theta-è¿æ¥$ã€è‡ªç„¶è¿æ¥ã€å¤–è¿æ¥[^2]ã€å·¦-å¤–è¿æ¥ã€å³-å¤–è¿æ¥ï¼‰
> ä¸‹é¢å°†å¯¹å„ç§è¿æ¥æ–¹æ³•è¿›è¡Œä¸€ä¸€ä»‹ç»

- å†…è¿æ¥ã€ç¬›å¡å°”ç§¯ã€$\theta-è¿æ¥$ï¼šè¿™ä¸‰è€…æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ç±»ï¼Œéƒ½æ˜¯åœ¨ç¬›å¡å°”ç§¯çš„åŸºç¡€ä¸Š+onæ¡ä»¶+whereæ¡ä»¶
- è‡ªç„¶è¿æ¥ï¼šåªä¿ç•™ç›¸åŒåˆ—åçš„å±æ€§å€¼ç›¸åŒçš„å…ƒç»„
- å·¦-å¤–è¿æ¥ã€å³-å¤–è¿æ¥ï¼šä»¥å·¦ä¸ºä¾‹ï¼Œå¯¹äºonæ¡ä»¶è€Œè¨€ï¼Œ**æ— è®ºå¦‚ä½•éƒ½ä¼šä¿ç•™å·¦è¡¨çš„å†…å®¹**ï¼Œä½†å¯¹äºwhereè€Œè¨€ï¼Œä¼šä¾æ®ç›¸å…³æ¡ä»¶è¿›è¡Œç­›é€‰

![[Pasted image 20230309190020.png]]

> [!tip] å…³äº`on`å’Œ`where`çš„åŒºåˆ«
>
> 1. `on`æ˜¯ç”Ÿæˆä¸´æ—¶è¡¨æ—¶ä½¿ç”¨çš„æ¡ä»¶ï¼Œå®ƒä¸ç®¡ on ä¸­çš„æ¡ä»¶æ˜¯å¦ä¸ºçœŸï¼Œéƒ½ä¼šè¿”å›å·¦è¾¹è¡¨ä¸­çš„è®°å½•
> 2. `where` æ¡ä»¶æ˜¯åœ¨ä¸´æ—¶è¡¨ç”Ÿæˆå¥½åï¼Œå†å¯¹ä¸´æ—¶è¡¨è¿›è¡Œè¿‡æ»¤çš„æ¡ä»¶ã€‚è¿™æ—¶å·²ç»æ²¡æœ‰ left join çš„å«ä¹‰ï¼ˆå¿…é¡»è¿”å›å·¦è¾¹è¡¨çš„è®°å½•ï¼‰äº†ï¼Œ_**æ¡ä»¶ä¸ä¸ºçœŸçš„å°±å…¨éƒ¨è¿‡æ»¤æ‰**_
>
> [è¯¥éƒ¨åˆ†å‚è€ƒæ–‡ç« åœ°å€](https://www.cnblogs.com/jessy/p/3525419.html)

##### å­æŸ¥è¯¢

> ç§°ä¸€ä¸ª`select-from-where`è¯­å¥ä¸ºä¸€ä¸ªæŸ¥è¯¢å—
> _å°†ä¸€ä¸ªæŸ¥è¯¢å—åµŒå¥—åˆ°å¦å¤–ä¸€ä¸ªæŸ¥è¯¢å—ä¸­ï¼Œè¿™æ ·çš„æŸ¥è¯¢æ–¹å¼ç§°ä¸ºå­æŸ¥è¯¢ï¼ˆä¸æ˜¯æ‰€æœ‰DBMSéƒ½æ”¯æŒå­æŸ¥è¯¢ï¼‰_
> _**psï¼šé€šå¸¸æŸ¥è¯¢å—åµŒå¥—åœ¨whereè¯­å¥å’Œhavingè¯­å¥ä¸­ï¼Œå½“ç„¶å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥æ”¾ç½®**_

```sql
select * from stu s1 # å¯¹stué‡å‘½åä¸ºs1ï¼Œåªéœ€è¦ä¹‹é—´ç©ºä¸€æ ¼å³å¯ï¼Œå½“ç„¶é€šè¿‡aså‘½åä¹Ÿå¯ä»¥
where s1.name in(select name from stu2);
# ä¹Ÿå¯ä»¥å°†å­æŸ¥è¯¢åµŒå¥—åˆ°fromè¯­å¥ä¸­ä½œä¸ºä¸´æ—¶è¡¨ğŸ‘‡ğŸ»
select SIS.Sno, Sname, Cno
from SC, (select Sno, Sname from Student where Sdept= 'IS') as SIS
where SC.Sno=SIS.Sno
```

> [!note] order by
> å­æŸ¥è¯¢ä¸­ï¼Œä½¿ç”¨`order by`è¯­å¥æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºåªéœ€è¦ç”¨åˆ°å†…å®¹ï¼Œä¸éœ€è¦å­æŸ¥è¯¢çš„é¡ºåº

- ç›¸å…³å­æŸ¥è¯¢ï¼šå­æŸ¥è¯¢çš„**æŸ¥è¯¢æ¡ä»¶**ä¾èµ–äºçˆ¶æŸ¥è¯¢
  - é¦–å…ˆå–å¤–å±‚æŸ¥è¯¢ä¸­è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç»„ï¼Œæ ¹æ®å®ƒä¸å†…å±‚æŸ¥è¯¢ç›¸å…³çš„å±æ€§å€¼å¤„ç†å†…å±‚æŸ¥è¯¢ï¼Œ**è‹¥WHEREå­å¥è¿”å›å€¼ä¸ºçœŸï¼Œåˆ™å–æ­¤å…ƒç»„æ”¾å…¥ç»“æœè¡¨**ï¼›
  - ç„¶åå†å–å¤–å±‚è¡¨çš„ä¸‹ä¸€ä¸ªå…ƒç»„ï¼›
  - é‡å¤è¿™ä¸€è¿‡ç¨‹ï¼Œç›´è‡³å¤–å±‚è¡¨å…¨éƒ¨æ£€æŸ¥å®Œä¸ºæ­¢
- ä¸ç›¸å…³å­æŸ¥è¯¢ï¼šç”±å†…å‘å¤–é€å±‚å¤„ç†ï¼Œ_**å­æŸ¥è¯¢çš„ç»“æœç”¨äºå»ºç«‹å…¶çˆ¶æŸ¥è¯¢çš„æŸ¥æ‰¾æ¡ä»¶**_

> [!warning]
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›¸å…³ä¸ä¸ç›¸å…³å­æŸ¥è¯¢ä»…ä»…åªæ˜¯å­æŸ¥è¯¢çš„ä¸¤ä¸ªåˆ†ç±»ï¼ˆåªæ˜¯æ¦‚å¿µä¸Šçš„ä¸åŒï¼Œä¸å­æŸ¥è¯¢ä½¿ç”¨çš„è°“è¯æ— å…³ï¼‰
> å¹¶ä¸”è¿™å—å†…å®¹ä¸å¤ªå¥½è¿›è¡Œè¯­è¨€æè¿°ï¼Œæ‰€ä»¥ä¹‹åå‡é‡‡ç”¨`ä»£ç +æ³¨é‡Š`çš„å½¢å¼è¿›è¡Œç†è§£

[[MySQL#^4fa73c]]:åˆ«å¿˜äº†å®ä¾‹è¡¨çš„ç»“æ„

å¸¦æœ‰`in`è°“è¯çš„å­æŸ¥è¯¢ğŸ‘‡ğŸ»

```sql
select Sno,Sname,Sdept 
from Student
where Sdept in
(
	select Sdept 
	from Student
	where Sname="åˆ˜æ™¨"
); # æ­¤ä¸ºä¸ç›¸å…³å­æŸ¥è¯¢
```

```sql
# ç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­(emmmmm...è¿™é‡Œçš„å¤æ‚è²Œä¼¼æ˜¯åœ¨ä½ ä¸ç”¨è‡ªç„¶è¿æ¥çš„å‰æä¸‹(ä¸ç”¨çš„è¯éœ€è¦ä¸‰å±‚æŸ¥è¯¢))
# æŸ¥è¯¢é€‰ä¿®äº†è¯¾ç¨‹åä¸ºâ€œä¿¡æ¯ç³»ç»Ÿâ€çš„å­¦ç”Ÿçš„å­¦å·å’Œå§“å
# 1. SCå’ŒCoè‡ªç„¶è¿æ¥ï¼Œå¾—åˆ°é€‰ä¿®ä¿¡æ¯ç³»ç»Ÿå­¦ç”Ÿçš„å­¦å·
# 2. ä»Stuä¸­é€‰æ‹©å­¦å·åœ¨å­æŸ¥è¯¢ä¸­çš„å­¦ç”Ÿçš„å­¦å·å’Œå§“åå³å¯
select Sno,Sname
from Stu
where Sno in
(
	select Sno
	from SC natural join Co
	where Cname="ä¿¡æ¯ç³»ç»Ÿ"
);
```

æ¯”è¾ƒè¿ç®—ç¬¦çš„å­æŸ¥è¯¢ğŸ‘‡ğŸ»($>,<,>=,<=,<>,!=,=$)

1. å†…å±‚æŸ¥è¯¢è¿”å›çš„å¾—æ˜¯==å•å€¼==ï¼Œå¦åˆ™ä¼šæŠ¥é”™
2. å­æŸ¥è¯¢è¦è·Ÿåœ¨æ¯”è¾ƒè¿ç®—ç¬¦åé¢

```sql
select Sno,Sname
from Stu
where Sage > (
	select avg(Sage)
	from Stu
);
```

å¸¦æœ‰`all,any`è°“è¯çš„å­æŸ¥è¯¢(ä¸€èˆ¬å’Œæ¯”è¾ƒè¿ç®—ç¬¦é…åˆä½¿ç”¨)

```sql
select Sname,Sage
from Stu
where Sage < any(
	select Sage
	from Stu
	where Sdept="Math"
); 
# è¿™é‡Œ any ç­‰ä»·äº `< select max(Sage) ...`
# åŒç†ï¼ŒæŠŠanyæ¢æˆallçš„è¯å°±ç­‰ä»·äº`< select min(Sage) ...`
```

> [!tip]
> ç›¸æ¯”allå’Œanyè°“è¯ï¼Œæ›´æ¨èä½¿ç”¨é›†å‡½æ•°æ›¿ä»£(å› ä¸ºé›†å‡½æ•°çš„æŸ¥è¯¢æ¬¡æ•°å°‘ï¼ŒæŸ¥è¯¢æ•ˆç‡é«˜)

###### existsè°“è¯

> å­˜åœ¨é‡è¯$\exists$,æ­¤è°“è¯è¾ƒä¸ºç‰¹æ®Šï¼Œéœ€è¦å•ç‹¬åˆ†åŒºè¿›è¡Œé˜è¿°

- å¸¦æœ‰`exists`è°“è¯çš„å­æŸ¥è¯¢ä¸è¿”å›ä»»ä½•æ•°æ®ï¼Œåªäº§ç”Ÿé€»è¾‘çœŸå€¼`true`(å­æŸ¥è¯¢ç»“æœéç©º)æˆ–é€»è¾‘å‡å€¼`false`(å­æŸ¥è¯¢ç»“æœä¸ºç©º)
- ç”±existså¼•å‡ºçš„å­æŸ¥è¯¢ï¼Œå…¶==ç›®æ ‡åˆ—è¡¨è¾¾å¼é€šå¸¸ç”¨`*`==(å› ä¸ºåªè¦çœ‹æœ‰æ— ç»“æœå…ƒç»„å³å¯ï¼Œç»™å‡ºåˆ—åæ¯«æ— æ„ä¹‰)
- ä¸€äº›å¸¦`exists/not exists`çš„å­æŸ¥è¯¢ä¸èƒ½è¢«å…¶ä»–å½¢å¼çš„å­æŸ¥è¯¢ç­‰ä»·æ›¿æ¢ï¼Œä½†æ˜¯æ‰€æœ‰å¸¦`in`ã€æ¯”è¾ƒè¿ç®—ç¬¦ã€`all`å’Œ`any`çš„å­æŸ¥è¯¢éƒ½å¯ä»¥è¢«å¸¦`exists`çš„å­æŸ¥è¯¢ç­‰ä»·æ›¿æ¢***(existså­æŸ¥è¯¢çš„ç‰¹æ®Šä¹‹å¤„)***
- `exists`è°“è¯ä¿®é¥°çš„å­æŸ¥è¯¢ï¼Œå¤šä¸º==_ç›¸å…³å­æŸ¥è¯¢_==
- `not exists`è°“è¯åŒç†

```sql
# ç¤ºä¾‹è„šæœ¬
create table A(
	a int,
	b int,
	primary key(a)
);
create table B(
	a int,
	c int,
	primary key(a)
);
insert into A(a,b)
values
(1,2),(2,3);
insert into B(a,c)
values
(1,2),(3,3)
```

å…³äº`exists`æŸ¥è¯¢çš„æ‰§è¡Œè¿‡ç¨‹ğŸ‘‡ğŸ»

![[CleanShot 2023-03-09 at 20.50.14.png]]

![[CleanShot 2023-03-09 at 20.50.32.png]]

```sql
# æŸ¥è¯¢æ‰€æœ‰é€‰ä¿®äº†1å·è¯¾ç¨‹çš„å­¦ç”Ÿåç§°
select Sname
from Stu
where exists(
	select * from SC
	where SC.Sno=Stu.Sno and SC.Cno=1
); # ç›¸å…³å­æŸ¥è¯¢
```

> [!important] é€šè¿‡exists/not existså®ç°å…¨ç§°é‡è¯$\forall$
> MySQLä¸æ”¯æŒ$\forall$[^3],é€šè¿‡ç¦»æ•£æ•°å­¦ç­‰ä»·è½¬åŒ–å®ç°$(\forall x)P<=>\neg(\exists x(\neg P))$
> å¹¶ä¸”åªèƒ½é€šè¿‡`exists`è°“è¯æ¥å®ç°å…¨ç§°é‡è¯ç›¸å…³çš„æŸ¥è¯¢æ“ä½œ
> ä¸ºäº†è¡¨è¾¾å…¨ç§°é‡åŒ–ï¼Œéœ€è¦å°†=="æ‰€æœ‰çš„è¡Œéƒ½æ»¡è¶³æ¡ä»¶P" è¿™æ ·çš„å‘½é¢˜è½¬æ¢æˆ "ä¸å­˜åœ¨ä¸æ»¡è¶³æ¡ä»¶Pçš„è¡Œ"==

```sql
# æŸ¥è¯¢é€‰ä¿®äº†å…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”Ÿå§“å=>x=è¯¾ç¨‹,P(x)ä»£è¡¨è¯¥å­¦ç”ŸSé€‰ä¿®äº†è¿™é—¨è¯¾ç¨‹=>ä¸å­˜åœ¨è¿™æ ·çš„è¯¾ç¨‹ï¼Œå­¦ç”ŸSæ²¡æœ‰é€‰ä¿®
# ä¸Šé¢çš„ç­‰ä»·è½¬æ¢è¿‡ç¨‹éå¸¸å…³é”®!!!!
select Sno,Sname
from Stu
where not exists(
	select *
	from Co
	where not exists(
		select *
		from SC
		where SC.Cno=Co.Cno and SC.Sno=Stu.Sno
	)
);
```

> [!important] é€šè¿‡exists/not existså®ç°é€»è¾‘è•´æ¶µ$\rightarrow$
> åŒæ ·å¯ä»¥é€šè¿‡è°“è¯æ¼”ç®—ï¼Œå°†é€»è¾‘è°“è¯è•´æ¶µç­‰ä»·è½¬æ¢ä¸º$p\rightarrow q<=>\neg p\vee q$

```sql
# æŸ¥è¯¢è‡³å°‘é€‰ä¿®äº†å­¦ç”Ÿ95002é€‰ä¿®çš„å…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”Ÿå·ç 
# æŸ¥è¯¢å­¦å·ä¸ºxçš„å­¦ç”Ÿï¼Œå¯¹æ‰€æœ‰çš„è¯¾ç¨‹yï¼Œåªè¦95002é€‰ä¿®äº†yï¼Œåˆ™xä¹Ÿé€‰ä¿®äº†y(ç‰›é€¼plusçš„æ€è·¯)
# æ‰€ä»¥æŠŠpç­‰ä»·äº95002é€‰ä¿®äº†è¯¾ç¨‹yï¼Œqç­‰ä»·äºå­¦ç”Ÿxé€‰ä¿®äº†è¯¾ç¨‹y
select Sno
from Stu
where exists(
	select Cno
	from SC
	where Cno not in(
		select Cno
		from SC where Sno='95002'
	)
	and Cno in (
		select Cno from SC where Sno=Stu.Sno
	)
);
# è¯¥æ–¹æ³•ä¸æ­£ç¡®ğŸ™…ğŸ»â€â™€ï¸
```

> [!warning]
> é€»è¾‘è°“è¯ç›¸å…³çš„å­æŸ¥è¯¢ï¼Œå¿…é¡»è½¬æ¢ä¸º$\neg,\exists$çš„å½¢å¼

$$
\begin{gather*}
(\forall y)p(y)\rightarrow q(y) \\
(\forall y)(p(y)\rightarrow q(y)) \\
(\forall y)(\neg p(y)\vee q(y)) \\
\neg(\exists y(\neg p(y)\vee q(y)))
\end{gather*}
$$

```sql
# æŸ¥è¯¢è‡³å°‘é€‰ä¿®äº†å­¦ç”Ÿ95002é€‰ä¿®çš„å…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”Ÿå·ç 
select Sno
from Stu
where not exists(
	select *
	from SC
	# ntäº†ï¼Œè¿™éƒ¨åˆ†æ’å‡äº†ï¼Œå¯¼è‡´æ•´ä½“æ’çœŸï¼Œæ‰€ä»¥æœ€åæ‰€æœ‰å­¦ç”Ÿéƒ½è¢«ç­›é€‰å‡ºæ¥äº†
	where not exists(
		select *
		from SC as SC1
		where SC1.Sno='95002' and SC1.Cno=SC.Cno
	) and exists(
		select *
		from SC as SC2
		where SC2.Sno=1 and Sc2.Cno=SC.Cno
	) 
);
# è¿˜æ˜¯é”™ğŸ™…ğŸ»â€â™€ï¸
```

æœ€ç»ˆè¿˜æ˜¯é€‰æ‹©å‚è€ƒä¸‹PPTä¸Šçš„ç­”æ¡ˆğŸ‘‡ğŸ»

```sql
# ä¸å­˜åœ¨è¿™æ ·çš„è¯¾ç¨‹yï¼Œå­¦ç”Ÿ95002é€‰ä¿®äº†yï¼Œè€Œå­¦ç”Ÿxæ²¡æœ‰é€‰
# ç¬¬ä¸€ä¸ªSC1æä¾›å­¦ç”Ÿï¼Œç¬¬äºŒä¸ªSC2æä¾›95002çš„å…¨éƒ¨è¯¾ç¨‹
# ç†è§£äº†ï¼ï¼ï¼ï¼
select Sno
from SC SC1
where not exists(
   select *
   from SC SC2
   where SC2.Sno='95002' not exists(
	   select *
	   from SC
	   where SC.Sno=SC1.Sno and SC.Cno=SC2.Cno
   )
)
```

> [!error]
> éš¾é¡¶ï¼Œéœ€è¦ç›¸å½“å¥½çš„ç›´è§‰

##### é›†åˆæŸ¥è¯¢

> å°±æ˜¯å¯¹äºæŸ¥è¯¢çš„ç»“æœé›†è¿›è¡Œå¹¶(`UNION`)ã€äº¤(`INTERSECT`)ã€å·®(`EXCEPT`)ç­‰è¿ç®—ï¼Œå•ä½æ˜¯é›†åˆ
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ==MySQLåªæ”¯æŒå¹¶æŸ¥è¯¢==ï¼Œå…¶ä½™æ“ä½œå‡å¯ä»¥é€šè¿‡å…³ç³»è¿ç®—ç¬¦å¾ˆæ–¹ä¾¿çš„å®ç°

è¯¥éƒ¨åˆ†å†…å®¹è¾ƒä¸ºç®€å•ï¼Œç›´æ¥çœ‹æ ·ä¾‹å³å¯

```sql
SELECT * FROM userlist
WHERE nation='CHINA'
UNION
SELECT * FROM userlist
WHERE age<=18;

# intersect
SELECT * FROM userlist
WHERE nation='CHINA' and age<=18;

# except
SELECT * FROM userlist
WHERE nation='CHINA' and age>18;

```

#### æ•°æ®æ›´æ–°

> Data Modification Language
> è¯¥éƒ¨åˆ†å†…å®¹æ¯”è¾ƒç®€å•ï¼Œåªå¯¹ç›¸å…³å†…å®¹è¿›è¡Œä¸¾ä¾‹å³å¯
> ps:è¯¥éƒ¨åˆ†å†…å®¹è¿‡äºç®€å•æ‰€ä»¥ç›´æ¥æŠŠå®ƒåˆå¹¶åˆ°æ•°æ®æŸ¥è¯¢å­æ ‡é¢˜ä¸‹äº†

å…±æœ‰ä¸‰ç§æ•°æ®æ›´æ–°ç±»å‹ğŸ‘‡ğŸ»

- Insertæ’å…¥ä¸€æ¡æˆ–å¤šæ¡å…ƒç»„
- Deleteåˆ é™¤ä¸€æ¡æˆ–å¤šæ¡å…ƒç»„
- Updateæ›´æ–°ç°æœ‰ä¸€æ¡æˆ–å¤šæ¡å…ƒç»„ä¸­çš„å€¼

_æ’å…¥å­æŸ¥è¯¢çš„å€¼_

```sql
create table tmp(
	id int auto_increment,
	age int default(18),
	name varchar(10),
	primary key(id)
);
insert into tmp(age,name)
select Sage,Sname
from stu
where Sname like "%åˆ˜%"
```

_ä¿®æ”¹æ•°æ®_

```sql
# åŸºæœ¬è¯­æ³•æ ¼å¼ update tb_name set col_name=xxx
# ä¿®æ”¹å•ä¸ªå…ƒç»„çš„å€¼
update Stu
set Sage=22
where Sno='95001'
# åŒæ—¶ä¿®æ”¹å¤šä¸ªå…ƒç»„çš„å€¼(å°†æ‰€æœ‰å­¦ç”Ÿçš„å¹´é¾„å¢åŠ ä¸€å²)
update Stu
set Sage=Sage+1;
# è‡³äºå’Œå­æŸ¥è¯¢ç­‰ç­‰ç»“åˆçš„ä¿®æ”¹è¯­å¥ä¸å†èµ˜è¿°ï¼Œå’ŒæŸ¥è¯¢ç»“åˆçš„åŸç†ç›¸åŒ
```

_åˆ é™¤æ•°æ®_

```sql
# åŸºæœ¬è¯­æ³•æ ¼å¼ï¼šdelete from tb_name where condition
delete from Stu
where Sno='95001'
# åˆ é™¤æ‰€æœ‰å…ƒç»„
delete from Stu;
```

### è§†å›¾

> What is View? And what is View used for?
> è§†å›¾æ˜¯ä¸€ä¸ªè™šæ‹Ÿè¡¨ï¼Œç±»ä¼¼äºå­æŸ¥è¯¢ï¼Œå®ƒæœ¬èº«å¹¶ä¸åŒ…å«æ•°æ®ï¼Œåªæ˜¯ä½œä¸ºä¸€ä¸ª`select`è¯­å¥ä¿å­˜åœ¨æ•°æ®å­—å…¸ä¸­(ç”¨æ¥åˆ›å»ºè§†å›¾çš„è¡¨ç§°ä¸ºåŸºè¡¨base table)
> è§†å›¾å°±æ˜¯ä¸€ä¸ªä¿å­˜åœ¨æ•°æ®å­—å…¸çš„å­æŸ¥è¯¢ï¼Œç”¨æˆ·é€šè¿‡è§†å›¾å¯ä»¥æ–¹ä¾¿çš„æŸ¥è¯¢åˆ°åŸºè¡¨çš„ç›¸å…³æ•°æ®ï¼Œè€Œä¸éœ€è¦äº†è§£åŸºè¡¨çš„æ•°æ®ç»“æ„

> [!note] ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è§†å›¾ï¼Ÿ
>
> 1. æ–¹ä¾¿æ€§ï¼šä½¿ç”¨è§†å›¾çš„ç”¨æˆ·å®Œå…¨ä¸éœ€è¦å…³å¿ƒåé¢å¯¹åº”çš„è¡¨çš„ç»“æ„ã€å…³è”æ¡ä»¶å’Œç­›é€‰æ¡ä»¶ï¼Œå¯¹ç”¨æˆ·æ¥è¯´å·²ç»æ˜¯è¿‡æ»¤å¥½çš„å¤åˆæ¡ä»¶çš„ç»“æœé›†
> 2. å®‰å…¨æ€§ï¼šä½¿ç”¨è§†å›¾çš„ç”¨æˆ·åªèƒ½è®¿é—®ä»–ä»¬è¢«å…è®¸æŸ¥è¯¢çš„ç»“æœé›†ï¼Œå¯¹è¡¨çš„æƒé™ç®¡ç†å¹¶ä¸èƒ½é™åˆ¶åˆ°æŸä¸ªè¡ŒæŸä¸ªåˆ—ï¼Œä½†æ˜¯é€šè¿‡è§†å›¾å°±å¯ä»¥ç®€å•çš„å®ç°
> 3. æ•°æ®ç‹¬ç«‹ï¼šä¸€æ—¦è§†å›¾çš„ç»“æ„ç¡®å®šäº†ï¼Œå¯ä»¥å±è”½è¡¨ç»“æ„å˜åŒ–å¯¹ç”¨æˆ·çš„å½±å“ï¼Œæºè¡¨å¢åŠ åˆ—å¯¹è§†å›¾æ²¡æœ‰å½±å“ï¼›æºè¡¨ä¿®æ”¹åˆ—åï¼Œåˆ™å¯ä»¥é€šè¿‡ä¿®æ”¹è§†å›¾æ¥è§£å†³ï¼Œä¸ä¼šé€ æˆå¯¹è®¿é—®è€…çš„å½±å“

#### è§†å›¾åˆ›å»º

> åˆ›å»ºè§†å›¾çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ğŸ‘‡ğŸ»

```sql
create [or replace] [algorithm={undefined|merge|temptable}]
view v_name [(col_list)]
as select_statement
[with [cascade|local] check option]
```

1. `on replace`ï¼šæ›¿æ¢å·²æœ‰è§†å›¾
2. `algorithm`ï¼šè§†å›¾é€‰æ‹©ç®—æ³•ï¼Œé»˜è®¤æ˜¯undefined(ç”±MySQLè‡ªåŠ¨é€‰æ‹©è¦ä½¿ç”¨çš„ç®—æ³•)
3. `select_statement`ï¼šselectè¯­å¥`select col_name from ... where ...`
4. `with [cascade|local] check option`ï¼šè§†å›¾åœ¨æ›´æ–°çš„æ—¶å€™è¦ä¿è¯åœ¨è§†å›¾çš„é€‰çº¿èŒƒå›´å†…
   1. cascadeä¸ºé»˜è®¤å€¼ï¼Œä»£è¡¨æ›´æ–°è§†å›¾æ—¶ï¼Œå¿…é¡»æ»¡è¶³è§†å›¾çš„ä¸€è‡´æ€§[^4]
   2. localè¡¨ç¤ºæ›´æ–°è§†å›¾æ—¶ï¼Œåªéœ€è¦æ»¡è¶³è¯¥è§†å›¾å®šä¹‰çš„ä¸€ä¸ªæ¡ä»¶å³å¯

> [!hint] å…³äºwith check option
> è¯¥é€‰é¡¹ç”¨äºä¿æŒè§†å›¾çš„ä¸€è‡´æ€§ï¼Œä¹Ÿå°±æ˜¯å¯¹äºé€šè¿‡è§†å›¾å¯¹äºåŸºè¡¨è¿›è¡Œçš„ä¿®æ”¹ï¼Œå¿…é¡»è¦èƒ½é€šè¿‡è¯¥è§†å›¾çœ‹åˆ°åŸºè¡¨ä¿®æ”¹åçš„ç»“æœ

```sql
# æœªè®¾ç½®check option
create view Born_2002_1 as
select id,Sname,Sage
from test1
where Sage=2002;
# å¯ä»¥æ”¯æŒæ’å…¥ä¸ç›¸å…³æ•°æ®
insert into Born_2002_1(Sname,Sage)
values
('tmp',2003),
('tmp1',2002);
# è®¾ç½®check option
create view Born_2002_2 as
select id,Sname,Sage
from test1
where Sage=2002
with check option;
# æ— æ³•æ’å…¥ï¼šCHECK OPTION failed 'test.born_2002_2'
insert into Born_2002_2(Sname,Sage)
values
('tmp3',2003),
('tmp4',2002);
```

> [!attention]
> è§†å›¾å…¶å®å°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿè¡¨ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªæ­£å¸¸çš„è¡¨æ¥æŸ¥è¯¢ã€æŸ¥çœ‹è¡¨ç»“æ„ç­‰ç­‰
> `select * from v_name`,`desc v_name`,......
> å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡`show tables`æ¥æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸‹çš„è§†å›¾(å› ä¸ºæœ¬è´¨å°±æ˜¯è¡¨å˜›)
> å¦‚æœè¦æŒ‡å®šæŸ¥è¯¢è§†å›¾çš„è¯ï¼Œéœ€è¦æŒ‡å®šcommentï¼Œ`show table status where comment='view'\G`(æ¨èåŠ ä¸Š\GæŒ‡ä»¤ï¼Œç›´æ¥æŸ¥å‡ºæ¥çš„è¡¨ç»“æ„æƒ¨ä¸å¿ç¹)

è§†å›¾å¯ä»¥_è‡ªå®šä¹‰åˆ—å_(å¦‚æœä¸è‡ªå®šä¹‰çš„è¯è‡ªåŠ¨ä½¿ç”¨selectè¯­å¥ä¸­çš„åˆ—å)

```sql
# è‡ªå®šä¹‰åˆ—å(æ³¨æ„åˆ—åæ•°é‡å¿…é¡»å’Œselectè¯­å¥ä¸­çš„ç›¸åŒ¹é…)
create view v_name(col1,col2,col3) as
select ...
```

#### è§†å›¾ä¿®æ”¹

> æœ‰ä¸¤ç§ä¿®æ”¹æ–¹æ³•ï¼Œ`alter`å’Œ`or replace`ï¼Œå»ºè®®ç›´æ¥é€šè¿‡`or replace`æ¥è¿›è¡Œä¿®æ”¹
> ps:ä¸»è¦æ˜¯alteræ‡’å¾—è®°äº†(è€Œä¸”`or replace`ç›¸å½“äºç›´æ¥é‡æ–°åˆ›å»ºäº†å¯¹åº”è§†å›¾ï¼Œæ›´åŠ æ–¹ä¾¿)

```sql
create or replace view Born_2002 as
select ...
```

#### è§†å›¾æ›´æ–°

> ä¸æ¨èğŸ™…ğŸ»â€â™€ï¸é€šè¿‡è§†å›¾å¯¹åŸºè¡¨è¿›è¡Œæ›´æ–°ï¼Œä¸‹é¢æ˜¯MySQLå¯¹äºè§†å›¾æ•°æ®æ›´æ–°çš„è¦æ±‚

1. selectå­å¥ä¸­åŒ…å«`distinct`
2. selectå­å¥ä¸­åŒ…å«**ç»„å‡½æ•°**
3. selectè¯­å¥ä¸­åŒ…å«`group by`å­å¥
4. selectè¯­å¥ä¸­åŒ…å«`order by`å­å¥
5. selectè¯­å¥ä¸­åŒ…å«`union` ã€`union all`ç­‰é›†åˆè¿ç®—ç¬¦
6. whereå­å¥ä¸­åŒ…å«**ç›¸å…³å­æŸ¥è¯¢**
7. fromå­å¥ä¸­åŒ…å«**å¤šä¸ªè¡¨**
8. å¦‚æœè§†å›¾ä¸­æœ‰**è®¡ç®—åˆ—**ï¼Œåˆ™ä¸èƒ½æ›´æ–°
9. å¦‚æœåŸºè¡¨ä¸­æœ‰**æŸä¸ªå…·æœ‰éç©ºçº¦æŸçš„åˆ—æœªå‡ºç°åœ¨è§†å›¾å®šä¹‰ä¸­**ï¼Œåˆ™ä¸èƒ½åšinsertæ“ä½œ

### ç´¢å¼•ä¸æŸ¥è¯¢ä¼˜åŒ–

> æš‚æ—¶æç½®

### ç”¨æˆ·è‡ªå®šä¹‰çº¦æŸ

> 1. Checkçº¦æŸï¼šé€šè¿‡é™åˆ¶è¾“å…¥åˆ°åˆ—ä¸­çš„å€¼æ¥é™åˆ¶åŸŸçš„å®Œæ•´æ€§
> 2. è§¦å‘å™¨(trigger)ï¼šEvent-Condition-Actionï¼Œåœ¨æ•°æ®åº“å‘ç”ŸæŸé¡¹æ›´æ–°çš„æ—¶å€™ï¼Œè§¦å‘æ‰§è¡Œaction

#### Checkçº¦æŸ

![[MySQL#^d28ee7]]

#### è§¦å‘å™¨

> What is trigger?
> è§¦å‘å™¨æ˜¯<mark style="background: #FFB86CA6;">è¡¨</mark>ç›¸å…³çš„æ•°æ®åº“å¯¹è±¡ï¼Œåªæœ‰åœ¨æ»¡è¶³è§¦å‘å™¨å®šä¹‰æ¡ä»¶çš„æ—¶å€™è§¦å‘ï¼Œå¹¶æ‰§è¡Œè§¦å‘å™¨ä¸­å®šä¹‰çš„è¯­å¥é›†åˆ

![[Pasted image 20230321143925.png]]

> [!attention]
> Cannot associate a trigger with a temporary table or view

è§¦å‘å™¨çš„äº”å¤§ç‰¹æ€§ğŸ‘‡ğŸ»

1. `trigger`ä¸»ä½“è¯­å¥ç”±`begin`å¼€å¤´ï¼Œ`end`ç»“å°¾
2. ä»€ä¹ˆæ¡ä»¶è§¦å‘ï¼š`Insert`ã€`Delete`ã€`Update`
3. ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼šåœ¨å¢åˆ æ”¹å‰æˆ–å
4. è§¦å‘é¢‘ç‡ï¼š_**é’ˆå¯¹æ¯è¡Œæ‰§è¡Œä¸€æ¬¡**_
5. è§¦å‘å™¨å®šä¹‰åœ¨è¡¨ä¸Š(æ— æ³•å¯¹ä¸´æ—¶è¡¨å’Œè§†å›¾å®šä¹‰trigger)ã€

> [!note]
> ä»è§¦å‘å™¨çš„è§¦å‘é¢‘ç‡ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œåº”è¯¥å°½é‡å°‘ä½¿ç”¨è§¦å‘å™¨ï¼ˆç‰¹åˆ«æ˜¯å¯¹äºå¢åˆ æ”¹éå¸¸é¢‘ç¹çš„è¡¨ï¼‰ï¼Œå› ä¸ºè¿™ä¼šå¤§å¤§é™ä½æ•°æ®åº“è¿è¡Œçš„æ•ˆç‡ï¼ˆ<mark style="background: #FFB8EBA6;">triggeré’ˆå¯¹æ¯ä¸€è¡Œéƒ½è¦æ‰§è¡Œä¸€æ¬¡</mark>ï¼‰
> å³ä½¿è¦ä½¿ç”¨ï¼Œbegin-endä¹‹é—´çš„è¯­å¥æ•ˆç‡ä¹Ÿåº”è¯¥å°½é‡é«˜

##### delimiter

> ç”¨äºäººä¸ºæŒ‡å®šå‘½ä»¤ç»“æŸç¬¦ï¼Œ`delimiter |`å°±æŒ‡å®šäº†`|`ä½œä¸ºmysqlå‘½ä»¤çš„ç»“æŸç¬¦

è¿™æ˜¯å› ä¸ºMySQLé»˜è®¤ä»¥`;`ä¸ºå‘½ä»¤ç»“æŸç¬¦ï¼Œè¿™æ ·çš„è¯åœ¨å‘½ä»¤è¡Œåˆ›å»ºå‡½æ•°ã€è§¦å‘å™¨ç­‰ç­‰è¯­å¥ä¸­åŒ…å«åˆ†å·çš„MySQLè¯­æ³•çš„è¯ï¼ŒMySQLå°±ä¼šç›´æ¥åœ¨å­å¥çš„ç»“å°¾ç»“æŸï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨`delimiter`äº‹å…ˆæŒ‡å®šç»“æŸç¬¦

```sql
delimiter ||
create trigger tg_name
before delete
on work for each row
begin
	insert into time values(now());
	insert into time values(now());
end||
delimiter ;
```

åŸºæœ¬å®šä¹‰è¯­å¥â†“

```sql
create trigger trigger_name
trigger_time trigger_event
on tb_name for each row
[trigger_order]
begin
	trigger_body
end
```

- trigger_time:æŒ‡å®šäº†è§¦å‘å™¨æ‰§è¡Œçš„æ—¶é—´(`before|after`)ï¼Œåœ¨äº‹ä»¶ä¹‹å‰orä¹‹å
- trigger_event:æŒ‡å®šè§¦å‘äº‹ä»¶(è§¦å‘æ¡ä»¶)
  - insertï¼šæ’å…¥æŸä¸€è¡Œæ—¶è§¦å‘è§¦å‘å™¨ï¼Œå¯èƒ½é€šè¿‡`insert`ã€load dataã€replaceè¯­å¥è§¦å‘
  - updateï¼šæ›´æ”¹æŸä¸€è¡Œæ—¶æ¿€æ´»è§¦å‘å™¨
  - deleteï¼šåˆ é™¤æŸè¡Œæ—¶æ¿€æ´»è§¦å‘å™¨
- trigger_orderï¼šä¸ºMySQL5.7åæ–°æ·»åŠ çš„å†…å®¹ï¼Œæš‚æ—¶ä¸è€ƒè™‘

```sql
create trigger tg1
after insert
on tb1 for each row
begin
	update tb1
	set insert_time=now()
	where id=new.id;
end
```

## Homework

1. [[æ•°æ®åº“ä½œä¸š_1]]
2. [[æ•°æ®åº“ä½œä¸š_2]]
3. [[æ•°æ®åº“ä½œä¸š_3]]
4. [[æ•°æ®åº“ä½œä¸š_4]]
5. [[æ•°æ®åº“ä½œä¸š_5]]

## Exper

1. [[æ•°æ®åº“å®éªŒ_1]]
2. [[æ•°æ®åº“å®éªŒ_2]]

## å­¦ä¹ èµ„æ–™

[MySQLç»ƒä¹ æ±‡æ€»](https://zhuanlan.zhihu.com/p/92590262)
[ç‹é™µçš„ä¸ªäººåšå®¢](https://www.cnblogs.com/wkfvawl/p/10889002.html)
[é’çŸ³è·¯çš„ä¸ªäººåšå®¢](https://www.cnblogs.com/youzhibing/p/11385136.html)
[æ·±å…¥è§£æMySQLè§†å›¾VIEW](https://www.cnblogs.com/geaozhang/p/6792369.html#chuangjianshitu)
[MySQLè§¦å‘å™¨triggerçš„ä½¿ç”¨](https://www.cnblogs.com/geaozhang/p/6819648.html)

# footnote

[^1]: å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡delimiteræ¥è‡ªå®šä¹‰ç»“æŸç¬¦å·ï¼ˆä¸€èˆ¬åœ¨æ•°æ®åº“è„šæœ¬ä¸­ä½¿ç”¨ï¼‰

[^2]: MySQLä¸­ä¸æ”¯æŒå¤–è¿æ¥ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡unionå®ç°åŒæ ·æ•ˆæœ

[^3]: ä»ç¦»æ•£æ•°å­¦çš„è§’åº¦å¾ˆå¥½è§£é‡Šï¼Œå·²çŸ¥$\neg,\exists$,å…¶ä»–æ‰€æœ‰çš„é€»è¾‘è°“è¯ä¹Ÿå°±èƒ½é¡ºåŠ¿æ¨å¯¼å‡ºæ¥äº†(å°±æ˜¯æœ‰ç‚¹éº»çƒ¦)

[^4]: ä¸€èˆ¬è§†å›¾å»ºè®®æŒ‡å®šæ­¤é€‰é¡¹ï¼Œé™¤éä½ å®šä¹‰çš„æ˜¯å¯æ›´æ–°çš„ç®€å•è§†å›¾
