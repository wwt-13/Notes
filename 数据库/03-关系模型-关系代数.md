[toc]

# 关系模型-关系代数

> 关系代数包括内容
>
> 1. 关系代数基本操作：并$\cup$、差$-$、**积**$\times$、**选择**$\sigma$、**投影**$\Pi$
> 2. 关系代数扩展操作：交、$\theta$-**连接**、**自然连接**
> 3. 关系代数组合与应用训练
> 4. 关系代数复杂扩展操作：除、外连接
> 4. 书写关系代数的基本思维训练：“一个集合，施加一个操作得到一个集合，依次施加关系代数操作，进而得到所需的集合”==以集合为中心==

## 关系代数概述

> **基于集合**，提供的一系列关系代数操作：<u>并、差、笛卡尔积（广义积）、选择、投影、更名</u>等基本操作
>
> 以及<u>交、连接和关系</u>除等一系列拓展操作，这是一种集合思维的操作语言
>
> 还是举以前举的一个例子：$\Pi_{姓名,课程名}\Big(\sigma_{课程号=c2}\big(R\bowtie S\big)\Big)$
>
> 是一种抽象的语言，是学习其他数据库语言，比如SQL语言的基础。

## 关系代数基本操作

> 一般分为两类操作：==集合操作==和==纯关系操作==
>
> 复杂动作就是关系代数定义的各种基本动作的各种组合
>
> <img src="https://gitee.com/ababa-317/image/raw/master/images/5ccfe0e904c43b59a2d54b1075a5e6f.jpg" style="zoom:67%;" />

- 集合操作

  |             操作              | 集合1 | 集合2 |    示例     |
  | :---------------------------: | :---: | :---: | :---------: |
  |          UNION（并）          |   R   |   S   |  $R\cup S$  |
  |      INTERSECTION（交）       |   R   |   S   |  $R\cap S$  |
  |       DIFFERENCE（差）        |   R   |   S   |    $R-S$    |
  | Cartesian PRODECT（笛卡尔积） |   R   |   S   | $R\times S$ |

- 纯关系操作

  |      操作       | 集合1 | 集合2 |       示例        |
  | :-------------: | :---: | :---: | :---------------: |
  | PROJECT（投影） |   R   |       |   $\Pi_{A}(R)$    |
  | SELECT（选择）  |   R   |       | $\sigma_{Con}(R)$ |
  |  JOIN（连接）   |   R   |   S   |   $R\bowtie S$    |
  | DIVISION（除）  |   R   |   S   |     $R\div S$     |

## 关系代数的并相容性

> 某些关系代数操作，比如**并、差、交**等，需要满足“并相容性”

**并相容性**

- 参与运算的两个关系及其相关属性之间有一定的对应性、可比性或意义关联性

  关系R和关系S存在相容性，当且仅当

  1. 关系R和关系S的**属性数目必须相同**
  1. 对于任意i，关系R的第i个属性和S的第i个**属性的域必须相同**
  
  假设$R(A_1,A_2...A_n),S(B_1,B_2,...B_m)$，关系R和关系S具有并相容性
  
  则$n=m \& Domain(A_i)=Domain(B_i)$

<u>并相容性示例</u>

$R=STUDENT(SID \ char(10),Sname\ char(8),Age\ char(3))$

$S=PROFESSOR(PID\ char(10),Pname\ char(8),Age\ char(3))$

1. 关系R和关系S的属性数目都是3
2. 关系R的属性SID与关系S的PID的域都是char(10)（char(10)是指存储10个字符，<u>但是这个为什么算是域？？？？</u>）
3. 关系R的属性Sname与关系S的Pname的域都是char(10)
4. 关系R的属性Age与关系S的Age的域都是char(10)

## 关系代数の基本操作

### 并

> ==和离散数学中的语义完全一致==

> 定义：假设关系R和关系S是**并相容的**，则关系R和关系S的并运算结果也是一个关系
>
> $R\cup S=由或者出现在关系R中，或者出现在S中的元组构成=\{t|t\in R\or t \in S\}$

**抽象并操作实例**

|      | $关系R$ |      |
| :--: | :-----: | :--: |
|  A1  |   A2    |  A3  |
|  a   |    b    |  c   |
|  a   |    d    |  g   |
|  f   |    b    |  e   |

|      | $关系R$ |      |
| :--: | :-----: | :--: |
|  B1  |   B2    |  B3  |
|  a   |    b    |  c   |
|  a   |    b    |  e   |
|  a   |    d    |  g   |
|  h   |    d    |  g   |

|      | $关系R\cup S$ |      |
| :--: | :-----------: | :--: |
|  C1  |      C2       |  C3  |
|  a   |       b       |  c   |
|  a   |       d       |  g   |
|  f   |       b       |  e   |
|  a   |       b       |  e   |
|  h   |       d       |  g   |

并操作实例2：

$R(参加体育队的学生)\cup S(参加文艺队的学生)=R\cup S(参加体育队或者参加文艺队的学生)$

### 差

> ==同样和离散数学中的定义完全一致==
>
> $R-S=\{t|t\in R \and t\notin S\}$

###  广义积

> 关系R和关系S的广义笛卡尔积运算结果也是一个关系，其由关系R中的元组和关系S中的元组进行所有可能的拼接/串接构成
>
> 数学描述：$R\times S=\{<a_1,a_2,...a_n,b_1,b_2,...b_m>|<a_1,a_2,...a_n>\in R\and <b_1,b_2,...b_n>\in S\}$，属性个数相加，**元组个数相乘**

- 关系R的元组数目是3，度数是3，关系S的元组数目是4，度数是4，则$R\times S$的元组数目是12，度数是7

<img src="https://gitee.com/ababa-317/image/raw/master/images/c67853daebe28a8f3d1ef00790167fd.jpg" style="zoom:67%;" />

关于广义笛卡尔积的作用

- <u>当一个检索涉及到**多个表**的时候（比如说学生表和课程表），就需要将这些表串接起来，然后才能检索，这是就需要用到广义笛卡尔积运算</u>

  ![](https://gitee.com/ababa-317/image/raw/master/images/d13080ed95afb45855184a17fd3e0dd.jpg)

- *是学习后面各种连接运算的基础*

### 选择

> 定义：给定一个关系R，同时给定一个选择条件condition（简记con），选择运算的结果也是一个关系，记为$\sigma_{con}R $，它从关系R中选择出满足给定条件condition的元组构成。
>
> 数学描述：$\sigma_{con}(R)=\{t|t\in R \and con(t)=True\}$

- 设$R(A_1,A_2,...A_n)$，t是R的元组，t的分量记为$t[A_i]$，或者简写为$A_i$
- 条件con由**逻辑运算符**连接**比较表达式**组成
- 逻辑运算符：$\and、\or、\neg$，或者写为and、or、not
- 比较表达式：$X\theta Y$，其中X、Y为$t$的**分量**、**常量**或**简单函数**，$\theta$是比较运算符，$\theta \in \{\gt,\lt,\ge,\le,=,\ne\}$

**选择操作实例（抽象）**

|      | $R$  |      |
| :--: | :--: | :--: |
|  A1  |  A2  |  A3  |
|  a   |  a   |  10  |
|  a   |  d   |  -4  |
|  f   |  b   |  5   |

1. 选择A3值大于0的元组？$\sigma_{A_3\gt0}(R) $
2. 选择A2值为a或者b的元组？$\sigma_{A_2="a" \or A_2="b"}(R)$
3. ......

选择运算符的优先级**和离散数学中的完全一致**

### 投影

> 定义：给定一个关系R，投影运算结果也是一个关系，记为$\Pi_A(R)$，它从关系R中选出属性包含在A中的类的构成（和选择操作类似，只不过一个选的是行，一个选的是列）
>
> 数学描述：$\Pi_{A_{i1},A_{i2},...A_{ik}}(R)=\{<t[A_{i1}],t[A_{i2}]...t[A_{ik}]>|t\in R\}$

- 设$R(A_1,A_2,...A_n)$
- $\{A_{i1},A_{i2},...,A_{ik}\}\subseteq \{A_1,A_2,...,A_n\}$
- 投影运算可以对原关系在投影之后重新排列（顺序无影响）
- 如果投影得到了重复元组，需要去掉

**投影操作实例**

|      |  R   |      |
| :--: | :--: | :--: |
|  A1  |  A2  |  A3  |
|  a   |  a   |  10  |
|  a   |  d   |  -4  |
|  f   |  b   |  5   |

1. 投影出A3列的元组？$\Pi_{A_3}(R)$
2. 投影出A3、A2列的元组？$\Pi_{A_3,A_2}(R)$
3. 查询所有A3大于5且A1等于a的A1、A2列的元组？$\Pi_{A_1,A_2}(\sigma_{A_3>5\and A_1="a"}(R))$



## 关系代数の扩展操作

### 交

> 定义：假设关系R和关系S是**并相容的（属性个数相同并且对应属性的域相同）**，则关系R与关系S的交运算结果也是一个关系，记作$R\cap S$，它是由**<u>同时出现在关系R和关系S中的元组组成的</u>**。
>
> 数学描述：$R\cap S=\{t|t\in R \and t\in S\}$
>
> 和离散数学中的理解基本一致，可以直接套用。

### theta连接

> 投影和选择操作只是对单个关系进行的操作，而实际应用中往往涉及到**多个表之间的操作**，这是就需要用到$\theta$-连接操作
>
> 定义：给定关系R和关系S，R和S的连接运算结果也是一个关系，记作$\mathop{R\bowtie S} \limits_{a\theta b}$，**它是由关系R和关系S的笛卡尔积中，选取R中属性a与S中属性b之间满足$\theta$条件的元组构成的。**
>
> 数学描述：$\mathop{R\bowtie S} \limits_{a\theta b}=\sigma_{t[a]\ \theta\ t[b]}(R\times S)$
>
> - t是R关系中的元组，s是关系S中的元组
> - 属性a和属性b必须具备可比性
> - $\theta\in\{>,<,\ge,\le,\neq,=\}$
>
> Plus：==$\theta$-连接经常和**投影$\Pi$**、**选择$\sigma$**在一起使用==

**抽象分析**

![](https://gitee.com/ababa-317/image/raw/master/images/a205d2e4053a8f00a98b27a649fc213.jpg)

**实例分析1**

![](https://gitee.com/ababa-317/image/raw/master/images/59d00e53a4c509498e1dbafd41f9718.jpg)

1. 查询数据结构成绩在90分以上的学生姓名（涉及到Student、Course、SC）

   此时姓名、课程名、成绩分别位于三个不同的表里面，此时查询成绩就需要用到$\theta$-连接操作

   猜测：$\Pi_{r[Sname]}(\mathop{R\bowtie S\bowtie T}\limits_{Score>90})$

**实例分析2**

![](https://gitee.com/ababa-317/image/raw/master/images/759923a72ddb0e05f3e590f5f91515e.jpg)

1. 找出所有员工的姓名以及其可能竞聘职位的名称（妙啊，感觉我又行了）

   $\Pi_{r[Wname],s[Type]}(\mathop{R\bowtie S}\limits_{Degree\ge Limited\_Degree})$

==实例分析3==

<img src="https://gitee.com/ababa-317/image/raw/master/images/1dc12e27a1e1ce6e4c131ad7435aa3a.jpg" style="zoom: 67%;" />

1. 查询98030101号同学和98040202号同学一起学过的所有课程号

   > 这里需要用到两个知识点，**表自身连接**与**更名操作$\rho$**
   >
   > 至于为啥要表自身连接（说不明白就感觉一下吧emmmmm）

   $$
   \Pi_{t[R.C\#]}(\sigma_{R.S\#=98030101\and R1.S\#=98040202}(\mathop{R\bowtie \rho_{R1}R}\limits_{R.C\#=R1.C\#}))
   $$

   注：上式中的$\rho_{R1}R$为表更名操作，即将表R更名为R1，当一个表需要**与自身进行连接运算**的时候，通常需要更名操作。

==Attention==：虽然$\theta$-连接的时候需要先进行笛卡尔积然后再进行选择来到得到$\theta$-连接的结果，但是这主要是为了方便理解，当引入连接操作时，DBMS可以直接进行连接操作，而不必先形成笛卡尔积（这样效率高还方便，所以应该尽量避免使用$\theta$-连接）

#### 等值连接操作

> 就是$\theta$-连接的变种，举例：$\mathop{R\bowtie S}\limits_{a=b}$，这种操作的好处是不会保留中间过程中笛卡尔积的运算结果，而是直接根据值相等进行连接，操作速度快且高效。

### 自然连接



### 除



### 外连接

