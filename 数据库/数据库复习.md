[toc]

# æ•°æ®åº“å¤ä¹ 

## å…³ç³»ä»£æ•°

## SQL è¯­è¨€

### æŸ¥è¯¢è¯­å¥æ‰§è¡Œé¡ºåº

```sql
select ...
from ...
where ...
group by ...
having ...
order by ...;
```

1. `from`è¯­å¥ç»„è£…æ¥è‡ªä¸åŒæ•°æ®æºçš„æ•°æ®->**é¦–å…ˆè·å–åˆ°æŸ¥è¯¢æ€»è¡¨**
2. `where`è¯­å¥åŸºäºæ‰§è¡Œæ¡ä»¶å¯¹è®°å½•è¡Œè¿›è¡Œç­›é€‰->å¯¹è·å–åˆ°çš„æ•°æ®è¿›è¡Œ**åˆæ­¥ç­›é€‰**
3. `group by`è¯­å¥å°†åˆæ­¥ç­›é€‰åçš„æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†ç»„->**å¯¹æ•°æ®æŒ‰ç…§ä¾æ®åˆ—è¿›è¡Œåˆ†ç»„**ï¼Œå¦‚æœä½¿ç”¨äº†`group by`ï¼Œé‚£ä¹ˆ**åç»­æ­¥éª¤å¾—åˆ°çš„æ•°æ®éƒ½åªèƒ½æ˜¯åˆ†ç»„ä¾æ®åˆ—å’Œèšåˆå‡½æ•°å€¼**
4. `select`å¯¹æœ€ç»ˆæ˜¾ç¤ºçš„æ•°æ®åˆ—è¿›è¡Œé€‰æ‹©->é€‰å‡ºæ•°æ®åˆ—ï¼Œå¦‚æœä¹‹å‰ä½¿ç”¨äº†`group by`åˆ™`select`å­—å¥ä¹Ÿ**åªèƒ½åŒ…å«åˆ†ç»„ä¾æ®åˆ—å’Œèšåˆå‡½æ•°**
5. `having`è¯­å¥å¯¹åˆ†ç»„ç»“æœè¿›è¡Œç­›é€‰->ç±»ä¼¼`where`ï¼Œä½†ä½œç”¨å¯¹è±¡æ˜¯ç»„ï¼ŒåŒç†ï¼Œåœ¨`having`è¯­å¥ä¸­å‡ºç°çš„**åªèƒ½æ˜¯ä½œä¸ºåˆ†ç»„ä¾æ®çš„åˆ—æˆ–è€…èšé›†å‡½æ•°**
6. `order by`å¯¹ç»“æœè¿›è¡Œæ’åº->æ’åº

### æ•°æ®åº“/è¡¨åŸºæœ¬æ“ä½œ

```sql
-- æŸ¥çœ‹æ•°æ®åº“
show databases;
-- ä½¿ç”¨æ•°æ®åº“
use db1;
-- æŸ¥çœ‹æ•°æ®åº“å†…çš„è¡¨
show tables;
-- åˆ›å»ºæ•°æ®åº“(æ•°æ®åº“æ²¡æœ‰`if [not] exists`ä¹‹ç±»çš„è¿ç”¨)
create database db1;
-- åˆ é™¤æ•°æ®åº“
drop database db1;
```

### è¡¨åˆ›å»º

```sql
create table [if not exists] tb1(
    col_name type constraint_1 constraint_2...
);
```

#### æ•°æ®ç±»å‹(type)

1. æ•°å€¼å‹

    - æ•´å‹ï¼š$tinyint,smallint,mediuint,int,bigint$
    - æµ®ç‚¹å‹(ä¸å¸¸ç”¨)ï¼š$float(M,D),decimal(M,D)$,M è¡¨ç¤ºæµ®ç‚¹å‹çš„é•¿åº¦ï¼ˆä¸åŒ…æ‹¬ç¬¦å·å’Œå°æ•°ç‚¹ï¼‰,D è¡¨ç¤ºå°æ•°ç‚¹åé¢æ•°å­—çš„ä½æ•°

    ```sql
    create table tb_name(
        id int,
        primary key(id)
    );
    ```

2. å­—ç¬¦å‹

    - $char,varchar,binary,varbinary,text$
    - æ¯”è¾ƒå¸¸è§çš„åªæœ‰ char å’Œ varchar

    ```sql
    create table tb_name(
        id int,
        # 10ä»£è¡¨å¯ä»¥å­˜å‚¨çš„å­—ç¬¦é•¿åº¦
        name varchar(10),
        primary key(id)
    );
    ```

3. æ—¥æœŸæ—¶é—´å‹
   ![](../assets/35136780b1cf8d893f30fda720a4e860.png)

    - $date,time,datetime,timestamp$
    - $date$æ—¶é—´ç±»å‹ä¸º`YYYY-MM-DD`,ç”¨äºè¡¨ç¤ºæ—¥æœŸ
    - $time$æ—¶é—´ç±»å‹ä¸º`HH:MM:SS`,ç”¨äºè¡¨ç¤ºæ—¶é—´
    - $datetime$æ—¶é—´ç±»å‹ä¸º`YYYY-MM-DD HH:MM:SS`
    - $timestamp$æ—¶é—´ç±»å‹ä¸º`YYYY-MM-DD HH:MM:SS`æ ¼å¼å’Œ datetime ç›¸åŒï¼Œä½†æ˜¯å–å€¼èŒƒå›´è¦å°äº datetime èŒƒå›´

    ```sql
    create table birth(
        id int auto_increment,
        birthday date,
        primary key(id)
    );
    insert into birth(birthday)
    values
    (curdate()),
    (date(now())),
    ('1999-01-12');
    ```

4. æšä¸¾å‹

    - $enum$

    ```sql
    create table tb1(
        id int,
        pri enum('LOW','MEDIUM','HIGH'),
        primary key(id)
    );
    ```

5. å¸ƒå°”å‹

    - $bool$
    - mysql ä¸­æ²¡æœ‰ç‹¬ç«‹çš„ bool ç±»å‹ï¼Œæ‰€ä»¥æ•°æ®åº“ä¸­å£°æ˜çš„ bool å€¼ä¼šè¢«è‡ªåŠ¨è½¬åŒ–ä¸º$tinyint$,1 ä»£è¡¨ true,0 ä»£è¡¨ false

    ```sql
    create table tb1(
        id int,
        win bool,
        primary key(id)
    );
    insert into tb1(id,win)
    values
    (1,1),
    (2,true);
    ```

#### çº¦æŸ(constraint)

-   `default`:é»˜è®¤çº¦æŸï¼Œç”¨äºæŒ‡å®šæŸåˆ—çš„é»˜è®¤å€¼
-   `not null`:éç©ºçº¦æŸï¼Œç”¨äºçº¦æŸæŸåˆ—éç©º
-   `auto_increment`:è‡ªå¢é•¿çº¦æŸï¼Œè¯¥åˆ—ä¸éœ€è¦ç”¨æˆ·è¾“å…¥ï¼Œè€Œæ˜¯ç”±æ•°æ®åº“ç³»ç»Ÿæ ¹æ®å®šä¹‰è‡ªåŠ¨èµ‹å€¼(æ¯å¢åŠ ä¸€æ¡è®°å½•ï¼Œä¸»é”®å°±ä¼šè‡ªåŠ¨ä»¥ç›¸åŒçš„æ­¥é•¿å¢é•¿)ï¼Œæ³¨æ„ä¸€ä¸ªè¡¨ä¸­**åªèƒ½æœ‰ä¸€ä¸ª**`auto_increment`çº¦æŸï¼Œå¹¶ä¸”*è¯¥å­—æ®µå¿…é¡»æœ‰å”¯ä¸€ç´¢å¼•*
-   `unique`:å”¯ä¸€å€¼çº¦æŸï¼Œç”¨äºæŸåˆ—ä¸èƒ½å‡ºç°é‡å¤å€¼
-   `primary key`:ä¸»é”®çº¦æŸ
-   `foreign key`:å¤–é”®çº¦æŸ

```sql
create table tb2(
    id int,
    primary key(id)
);
create table tb1(
    id int auto_increment,
    name varchar(10) not null,
    age int default(15),
    num int unique,
    primary key(id,num),
    foreign key(num) references tb2(id)
);
```

### å•è¡¨æŸ¥è¯¢

```sql
create table tb1(
    id int auto_increment,
    name char(10) not null,
    age int default(18),
    primary key(id)
);
-- æŸ¥è¯¢æ‰€æœ‰
select * from tb1;
-- æŸ¥è¯¢å­¦å·ã€å§“å
select id,name
from tb1;
-- æŸ¥è¯¢ç»è¿‡è®¡ç®—çš„å€¼(asåæ˜¯é‡æ–°å‘½åçš„åˆ—å)
select id+1 as id_1
from tb1;
-- å–æ¶ˆé‡å¤è¡Œ(éœ€è¦æ³¨æ„çš„æ˜¯distinctä½œç”¨çš„èŒƒå›´æ˜¯æ‰€æœ‰ç›®æ ‡åˆ—)
select distinct name
from tb1;
-- ä¿ç•™é‡å¤è¡Œ(allä¸ºé»˜è®¤å€¼)
select all name
from tb1;
-- å¤§å°æ¯”è¾ƒ
select * from tb1
where age>20 and id<2;
-- `between...and`
select * from tb1
where age between 10 and 20;
-- é›†åˆé€‰æ‹©
select * from tb1
where age in (18,29,50);
-- å­—ç¬¦ä¸²åŒ¹é…1(`%`ä»£è¡¨åŒ¹é…ä»»æ„é•¿åº¦çš„å­—ç¬¦ä¸²)
select * from tb1
where name like "%å´%";
-- å­—ç¬¦ä¸²åŒ¹é…2(`_`ä»£è¡¨åŒ¹é…å•ä¸ªå­—ç¬¦)
select * from tb1
where name like "å´__"
-- å­—ç¬¦ä¸²åŒ¹é…3(å½“ç”¨æˆ·è¦æŸ¥è¯¢çš„å­—ç¬¦ä¸²æœ¬èº«å°±å«æœ‰ % æˆ– _ æ—¶ï¼Œè¦ä½¿
ç”¨escape '<æ¢ç å­—ç¬¦>'å¯¹å…¶è¿›è¡Œè½¬ä¹‰)
select * from tb1
where name like 'DB*_%i__' escape '*';
-- æ¶‰åŠç©ºå€¼çš„æŸ¥è¯¢
select * from tb1
where name is not null;
-- æŸ¥è¯¢ç»“æœæ’åº(ascä¸ºå‡åºï¼Œdescä¸ºé™åºï¼Œç©ºå€¼é»˜è®¤ä¸ºæœ€å°å€¼)
select * from tb1
order by age asc;
```

### èšé›†å’Œåˆ†ç»„

> åœ¨ select å­å¥ä¸­å¯ä»¥ä½¿ç”¨é›†å‡½æ•°ï¼Œå¯¹æŒ‡å®šçš„åˆ—è¿›è¡Œèšåˆè®¡ç®—

-   count([distinct|all]<åˆ—å>|\*)è®¡æ•°
-   sum([distinct|all]<åˆ—å>)æ€»å’Œ
-   avg([distinct|all]<åˆ—å>)å¹³å‡æ•°
-   max([distinct|all]<åˆ—å>)æœ€å¤§å€¼
-   min([distinct|all]<åˆ—å>)æœ€å°å€¼

```sql
-- æŸ¥è¯¢å­¦ç”Ÿæ€»äººæ•°
select count(*) from stu;
```

> ä½¿ç”¨`group by`å¯¹åˆæ­¥ç­›é€‰åçš„æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªç»„ï¼Œå¯ä»¥ç»†åŒ–é›†å‡½æ•°çš„ä½œç”¨å¯¹è±¡ï¼Œå¯¹æŸ¥è¯¢ç»“æœåˆ†ç»„åï¼Œé›†å‡½æ•°å°†åˆ†åˆ«ä½œç”¨äºæ¯ä¸ªç»„
>
> where å­å¥ä¸èƒ½ä½¿ç”¨é›†å‡½æ•°ï¼Œå› ä¸º*æ‰§è¡Œ where è¯­å¥æ—¶ï¼Œè¿˜æœªå¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œåˆ†ç»„*

```sql
select A,count(*)
from tb1
group by A;
```

> ä½¿ç”¨`having`è¯­å¥ç­›é€‰å‡ºæœ€ç»ˆç»“æœ,é€šè¿‡ having è¯­å¥ç­›é€‰å‡ºç¬¦åˆç‰¹å®šæ¡ä»¶çš„ç»„

```sql
select A,count(*)
from tb1
group by A
having count(*)>5;
```

## å¤šè¡¨æŸ¥è¯¢

> `from`è¯­å¥ä¸­æ¶‰åŠå¤šè¡¨çš„è¿æ¥æ“ä½œ

```sql
-- å¹¿ä¹‰ç¬›å¡å°”ç§¯è¿æ¥
select * from stu,sc;
-- ç­‰å€¼è¿æ¥(ä»¥ä¸‹äºŒè€…ç­‰ä»·)
select * from stu,sc
where stu.no=sc.no;
select * from stu join sc
on stu.no=sc.no;
-- è‡ªç„¶è¿æ¥
select * from stu natural join sc;
-- è‡ªè¿æ¥æŸ¥è¯¢(èµ·åˆ«å)
select First.Cno,Second.Cno
from Course as First join Course as Second
on First.Cpno=Second.Cno;
-- å†…è¿æ¥
select * from tb1 join tb2
on tb1.id=tb2.id;
-- å¤–è¿æ¥(å·¦)
select * from tb1 left join tb2
on tb1.id=tb2.id;
-- å¤–è¿æ¥(å³)
select * from tb1 right join tb2
on tb1.id=tb2.id;
-- å¤–è¿æ¥(å…¨)
select * from tb1 left join tb2 on tb1.id=tb2.id
union
select * from tb1 right join tb2 on tb1.id=tb2.id;
```

å†…å¤–è¿æ¥æ‰€ç”¨è¡¨ ğŸ‘‡ğŸ»
tb1

| id  | name |
| --- | ---- |
| 1   | wwt  |
| 2   | GG   |
| 3   | null |
| 4   | CC   |

tb2

| id  | age  |
| --- | ---- |
| 1   | 12   |
| 2   | null |
| 3   | 18   |
| 5   | 20   |

### å­æŸ¥è¯¢

```sql
-- whereè¯­å¥åµŒå¥—
select sname from stu
where sno in(
    select sno from sc
    where cno=2
);
-- fromè¯­å¥ä¸´æ—¶è¡¨(éœ€è¦èµ·åˆ«åæ‰èƒ½ä½¿ç”¨)
select SIS.Sno,Sname,Cno
from SC,(
    select Sno,Sname from stu
    where Sdept='IS'
) as SIS
where SC.Sno=SIS.Sno
```

### è¡¨ä¿®æ”¹

```sql
alter table tb_name
[add new_col_name data_type [integrity_constraints]|integrity_constraints]
[drop col_name|integrity_constraints]
[modify col_name data_type [integrity_constraints]]
[change col_name new_col_name data_type [integrity_constraints]];
```

```sql
# æ·»åŠ å­—æ®µ
alter table tb_name add co_name varchar(80) not null;
# åˆ é™¤å­—æ®µ
alter table tb_name drop co_name;
# ä¿®æ”¹å­—æ®µ
alter table tb_name modify co_name char(10) default 'GG';
```

### æ•°æ®æ›´æ–°

```sql
-- æ•°æ®æ’å…¥(çœç•¥)
-- æ•°æ®åˆ é™¤
delete from tb_name
where ...;
-- æ•°æ®æ¸…ç©º
delete from tb_name;
-- æ•°æ®æ›´æ–°
update tb_name
set Sage=22 -- æ­¤å¤„æ¡ä»¶å¯ä»¥ä¸ºå¤šä¸ªï¼Œæ¡ä»¶ä¹‹é—´ä½¿ç”¨','éš”å¼€
where Sno='95001';
-- æ•°æ®æ›´æ–°(è¡¨è¾¾å¼)
update tb_name
set Sage=Sage+1;
```

### è§†å›¾

> è§†å›¾æ˜¯ä¸€ç§è™šæ‹Ÿè¡¨ï¼Œæ˜¯ä»ä¸€ä¸ªæˆ–å‡ ä¸ªè¡¨ä¸­å¯¼å‡ºçš„è¡¨ï¼Œå®ƒçš„å®šä¹‰å’Œåå­—å¾ˆåƒï¼Œâ€œè§†å›¾â€
>
> æœ¬è´¨ä¸Šå°±æ˜¯åœ¨æ•°æ®å­—å…¸ä¸­å­˜å‚¨çš„ä¸€æ¡`select`è¯­å¥

```sql
create view <è§†å›¾å> [(<åˆ—å>[,<åˆ—å>...])]
as
<å­æŸ¥è¯¢>
[with check option];
```

```sql
create view IS_S1(Sno,Sname,Grade)
as
select Student.Sno,Sname,Grade
from Student,SC
where Sdept='IS' and Student.Sno=SC.Sno and SC.Cno='1';
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**å¸¦è¡¨è¾¾å¼çš„è§†å›¾å¿…é¡»æ˜ç¡®å®šä¹‰ç»„æˆè§†å›¾çš„å„ä¸ªå±æ€§åˆ—å**

```sql
create view BT_S(Sno,Sname,Sbirth)
as
select Sno,Sname,2000-Sage
from Student
where Sdept='IS'
with check option;
```

å¹¶ä¸”ï¼Œé€è¿‡è§†å›¾è¿›è¡Œå¢åˆ æ”¹æ“ä½œæ—¶ï¼Œä¸èƒ½ç ´åè§†å›¾ä¸­å®šä¹‰çš„è°“è¯æ¡ä»¶(å­æŸ¥è¯¢ä¸­çš„æ¡ä»¶è¡¨è¾¾å¼)

## æ•°æ®åº“ç¼–ç¨‹

### å­˜å‚¨è¿‡ç¨‹

> å¯ä»¥å°†*å¤šæ¬¡é‡å¤æ‰§è¡Œ*çš„ä»£ç æ®µç¼–å†™æˆä¸€ä¸ªè¿‡ç¨‹ï¼Œä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œä¾›éœ€è¦çš„æ—¶å€™è°ƒç”¨
>
> ä½äºæ•°æ®åº“æœåŠ¡å™¨ä¸Šï¼Œè°ƒç”¨çš„æ—¶å€™æ— éœ€é€šè¿‡ç½‘ç»œä¼ è¾“å¤§é‡æ•°æ®
>
> å¯ä»¥ä½œä¸ºä¸€ç§å®‰å…¨æœºåˆ¶æ¥åŠ ä»¥å……åˆ†åˆ©ç”¨ã€‚ä¾‹å¦‚å‚æ•°åŒ–çš„å­˜å‚¨è¿‡ç¨‹å¯ä»¥é˜²æ­¢ SQL æ³¨å…¥å¼çš„æ”»å‡»

**åˆ›å»ºã€åˆ é™¤ã€è°ƒç”¨åŸºæœ¬è¯­æ³•**

```sql
-- åˆ›å»º
create procedure p_name(
    [in|out|inout] param_name type [,...]
)
[begin]
    sql_statement
[end]
-- åˆ é™¤
drop procedure p_name
-- è°ƒç”¨
call procedure (param_name type [,...])
```

```sql
delimiter $$
-- inä»£è¡¨è¾“å…¥å‚æ•°ï¼Œoutä»£è¡¨è¾“å‡ºå‚æ•°
create procedure delete matches(in player_no int)
begin
    delete from tb1
    where id=player_no;
end $$
```

```sql
delimiter $$
create procedure out_param(out p_out int)
begin
    select p_out;
    set p_out=2;
    select p_out;
end $$
-- æ‰§è¡Œcall out_param(@p_out)ä¼šå°†å˜é‡@p_outè®¾ç½®ä¸º2
```

```sql
-- å­˜å‚¨è¿‡ç¨‹ä½“
begin
    begin
        begin
            statements;
        end
    end
end
-- æ‰“æ ‡ç­¾
label1: begin
    label2: begin
        label3: begin
            statements;
        end label3;
    end label2;
end label1
```

å˜é‡å£°æ˜

```sql
declare variable_name [,variable_name...] type [default value];
```

```sql
delimiter $$
create procedure pro1(in param1 int)
begin
    declare variable1 char(10);
    if param1=17 then
        set variable1='birds';
    else
        set variable1='tests';
    end if;
    insert into tables values (variable1);
end
```

#### æ¡ä»¶è¯­å¥

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå†…éƒ¨å˜é‡ä»…åœ¨`begin...end`ç»“æ„å†…æœ‰æ•ˆï¼Œæ‰§è¡Œåˆ° end æ—¶ï¼Œå†…éƒ¨å˜é‡æ¶ˆå¤±

`if then...else...end if`

```sql
delimiter $$
create procedure pro1(in param1 int)
begin
    declare var int;
    set var=param1+1;
    if var=0 then
        insert into t values(17);
    end if;
    if param1=0 then
        update t set s1=s1+1;
    else
        update t set s1=s1+1;
    end if;
end $$
```

`case when then ... when then ... else ... end case`

```sql
delimiter $$
create procedure pro1(in param1 int)
begin
    declare var int;
    set var=param1+1;
    case var
        when 0 then
            insert into t values(17);
        when 1 then
            insert into t values(18);
        else
            insert into t values(19);
    end case;
end $$
```

#### å¾ªç¯è¯­å¥

`while ... end while`

```sql
delimiter $$
create procedure pro1()
begin
    declare var int default(0);
    while var<6 do
        insert into t values(var);
        set var=var+1;
    end while;
end
```

`repeat ... end repeat`

```sql
delimiter $$
create procedure pro1()
begin
    declare v int default(0);
    repeat
        insert into t values(v);
        set v=v+1;
        until v>=5;
    end repeat;
end$$
```

`loop ... endloop`

```sql
delimiter $$
create procedure pro1()
begin
    declare v int default(0);
    set v=0;
    loop_label:loop
        insert into t values(v);
        set v=v+1;
        if v=3 then
            -- ç±»ä¼¼äºcontinue
            iterate loop_label;
        end if;
        if v>=5 then
            -- leaveè¯­å¥çš„æ„ä¹‰æ˜¯ç¦»å¼€å¾ªç¯ï¼Œç±»ä¼¼äºbreak
            leave loop_label;
        end if;
    end loop;
end$$
```

## å®Œæ•´æ€§çº¦æŸ

### é™æ€åˆ—çº§çº¦æŸ

> å¯¹åˆ—çš„å€¼åŸŸã€ç±»å‹ã€æ˜¯å¦ç©ºå€¼çº¦æŸ
>
> ç›´æ¥é€šè¿‡ constraint çº¦æŸå³å¯

```sql
create table tb1(
    id int primary key,
    name varchar(10) not null
);
```

### é™æ€å…ƒç»„çº¦æŸ

> è§„å®šå…ƒç»„çš„å„ä¸ªåˆ—ä¹‹é—´çš„çº¦æŸå…³ç³»
>
> é€šè¿‡`check`çº¦æŸå®ç°

```sql
create table tb1(
    id int primary key,
    age1 int,
    age2 int,
    check(age1<=age2)
);
```

### é™æ€å…³ç³»çº¦æŸ

> å…³ç³»çš„**å„ä¸ªå…ƒç»„**ä¹‹é—´æˆ–è‹¥å¹²å…³ç³»ä¹‹é—´å­˜åœ¨çš„å„ç§è”ç³»æˆ–çº¦æŸ
>
> éœ€è¦é€šè¿‡*è§¦å‘å™¨*å®ç°

æ¯”æ–¹è¯´èŒå·¥å¹³å‡å·¥èµ„<=éƒ¨é—¨ç»ç†å·¥èµ„...

### åŠ¨æ€åˆ—çº§çº¦æŸ

> ä¿®æ”¹åˆ—å®šä¹‰æˆ–åˆ—å€¼æ—¶åº”è¯¥æ»¡è¶³çš„çº¦æŸæ¡ä»¶
>
> 1. ä¿®æ”¹åˆ—å®šä¹‰ï¼šç”±æ•°æ®åº“è‡ªåŠ¨å®ç°
> 2. ä¿®æ”¹åˆ—å€¼ï¼šç”±**è§¦å‘å™¨**å®ç°

### åŠ¨æ€å…ƒç»„çº¦æŸ

> ä¿®æ”¹å…ƒç»„å€¼æ—¶ï¼Œå„ä¸ªå­—æ®µä¹‹é—´éœ€è¦æ»¡è¶³çš„çº¦æŸæ¡ä»¶
> èŒå·¥å·¥èµ„è°ƒæ•´ä¸å¾—ä½äºå…¶åŸæ¥å·¥èµ„ + å·¥é¾„\*1.5
> *è§¦å‘å™¨*å®ç°

### åŠ¨æ€å…³ç³»çº¦æŸ

> å¯¹å…³ç³»å˜åŒ–å‰åçŠ¶æ€çš„é™åˆ¶æ¡ä»¶
>
> å…·ä½“å†…å®¹åœ¨äº‹åŠ¡å¤„ç†éƒ¨åˆ†è®²è§£

### è§¦å‘å™¨

> æ˜¯ç”¨äºå®ç°å¤æ‚é€»è¾‘çš„ç”¨æˆ·è‡ªå®šä¹‰çº¦æŸçš„å·¥å…·
>
> æ˜¯ä¸€ç§**ç‰¹æ®Šçš„å­˜å‚¨è¿‡ç¨‹**ï¼ˆç”±æ•°æ®åº“è‡ªåŠ¨è°ƒç”¨ï¼Œç”¨æˆ·æ— æ³•è°ƒç”¨ï¼Œä¸”æ²¡æœ‰å‚æ•°å’Œè¿”å›å€¼ï¼‰

```sql
create [or replace] trigger trigger_name
[before|after|instead of] trigger_event on tb_name
[for each row[when trigger_condition]]
trigger_body;
```

```sql
create trigger trigger_name
[before|after] trigger_event on tb_name
[for each row[when trigger_condition]]
trigger_body;
```

åº”ç”¨å®ä¾‹ï¼š

-   Fruits(<u>Fname</u>,Price);Sells(<u>Cname</u>,Fname,<u>Stime</u>,Quantity)
-   å½“*å‘ Sells è¡¨ä¸­æ’å…¥ä¸€æ¡æ–°çš„è´­ä¹°è®°å½•æ—¶ï¼Œè‹¥ Fname åœ¨ fruits ä¸­ä¸å­˜åœ¨ï¼Œåˆ™éœ€è¦å‘ Fruits è¡¨ä¸­æ’å…¥ä¸€æ¡æ–°çš„è®°å½•*ï¼Œå…¶ä¸­ Fname ä¸ºæ–°è´­ä¹°è®°å½•ä¸­çš„æ°´æœåç§°ï¼ŒPrice ä¸º NULL

```sql
create trigger fruit_trigger
after insert on sells -- äº‹ä»¶
for each row
when(new.Fname not in(select Fname from Fruits))
insert into Fruits(Fname)
values
(new.Fname);
```

-   `before`,`after`å‚æ•°æŒ‡å®šäº†è§¦å‘å™¨æ‰§è¡Œçš„æ—¶é—´ï¼Œåœ¨äº‹ä»¶ä¹‹å‰æˆ–ä¹‹å
-   `for each row`è¡¨ç¤ºä»»ä½•ä¸€æ¡è®°å½•ä¸Šçš„æ“ä½œæ»¡è¶³è§¦å‘äº‹ä»¶éƒ½ä¼šè§¦å‘è§¦å‘å™¨ï¼Œç¼ºçœä¸ºæ¯æ‰§è¡Œä¸€æ¡è¯­å¥è§¦å‘ä¸€æ¬¡
-   **trigger_event**
    -   insert å‹è§¦å‘å™¨ï¼šæ’å…¥æŸä¸€è¡Œæ—¶æ¿€æ´»è§¦å‘å™¨
    -   update å‹è§¦å‘å™¨ï¼šæ›´æ”¹æŸä¸€è¡Œæ—¶æ¿€æ´»è§¦å‘å™¨ï¼Œé€šè¿‡ update è¯­å¥è§¦å‘
    -   delete å‹è§¦å‘å™¨ï¼šåˆ é™¤æŸä¸€è¡Œæ—¶æ¿€æ´»è§¦å‘å™¨
-   _new/old_
    -   insert å‹è§¦å‘å™¨ï¼šnew ä»£è¡¨å°†è¦æ’å…¥çš„æ•°æ®ï¼Œold ä»£è¡¨å·²ç»æ’å…¥çš„æ–°æ•°æ®
    -   update å‹è§¦å‘å™¨ï¼šnew ä»£è¡¨æ–°æ•°æ®ï¼Œold ä»£è¡¨åŸæ•°æ®
    -   delete å‹è§¦å‘å™¨ï¼šold ä»£è¡¨å°†è¦æˆ–å·²ç»è¢«åˆ é™¤çš„åŸæ•°æ®
        å¹¶ä¸” old æ˜¯åªè¯»çš„ï¼Œè€Œ new åˆ™å¯ä»¥åœ¨è§¦å‘å™¨ä¸­ä½¿ç”¨ set èµ‹å€¼(**ä¸ä¼šå†æ¬¡æ¿€æ´»è§¦å‘å™¨**)

```sql
create table account(
    acct_num int,
    amount decimal(10,2)
);
insert into account
values
(137,14.98),(141,1937.50),(97,-100.00);
delimiter $$
create trigger upd_check
before update on account
for each row
begin
    if new.amount<0 then
        set new.amount=0;
    elseif new.amount>100 then
        set new.amount=100;
    end if;
end$$
delimiter ;
update account
set amount=-10
where acct_num=137;
```

## æ•°æ®åº“å®‰å…¨

> æ•°æ®åº“çš„ä¸€å¤§ç‰¹ç‚¹æ˜¯æ•°æ®å¯ä»¥å…±äº«ï¼Œä½†æ˜¾ç„¶è¿™ç§å…±äº«ä¸èƒ½æ˜¯æ— æ¡ä»¶çš„å…±äº«
>
> æ•°æ®åº“ä¸­æ•°æ®çš„å…±äº«æ˜¯åœ¨ DBMS ç»Ÿä¸€çš„ä¸¥æ ¼çš„æ§åˆ¶ä¸‹çš„å…±äº«ï¼Œå³*åªå…è®¸æœ‰åˆæ³•ä½¿ç”¨æƒé™çš„ç”¨æˆ·è®¿é—®å…è®¸ä»–å­˜å–çš„æ•°æ®*
>
> æ•°æ®åº“çš„å®‰å…¨æ˜¯æŒ‡ä¿æŠ¤æ•°æ®åº“ï¼Œé˜²æ­¢å› ç”¨æˆ·éæ³•ä½¿ç”¨æ•°æ®åº“é€ æˆæ•°æ®æ³„éœ²ã€æ›´æ”¹æˆ–ç ´åç­‰æ¶æ„äººä¸ºç ´åé—®é¢˜

## å¹¶å‘æ§åˆ¶

> æ¯ä¸ªç”¨æˆ·åœ¨å­˜å–æ•°æ®åº“ä¸­çš„æ•°æ®æ—¶ï¼Œéƒ½æ˜¯å¹¶è¡Œå­˜å–çš„
>
> è¿™å°±å¯¼è‡´äº†å¦‚æœä¸å¯¹å¹¶å‘æ“ä½œåŠ ä»¥æ§åˆ¶å°±å¯èƒ½ä¼šäº§ç”Ÿä¸æ­£ç¡®çš„æ•°æ®ï¼Œç ´åæ•°æ®çš„ä¸€è‡´æ€§
>
> æ•°æ®åº“çš„å¹¶å‘æ§åˆ¶æ˜¯ä»¥**äº‹åŠ¡**ä¸ºåŸºæœ¬å•ä½è¿›è¡Œçš„ï¼Œé€šè¿‡*å¯¹äº‹åŠ¡æ‰€æ“ä½œçš„æ•°æ®æ–½åŠ å°é”*æ¥å®ç°ä¸€è‡´æ€§

### äº‹åŠ¡(transaction)

> äº‹åŠ¡æ˜¯ç”¨æˆ·å®šä¹‰çš„ä¸€ä¸ªæ•°æ®åº“æ“ä½œåºåˆ—ï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åšï¼Œ**æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½**
>
> **äº‹åŠ¡çš„å¼€å§‹ä¸ç»“æŸå¯ä»¥ç”±ç”¨æˆ·æ˜¾å¼æ§åˆ¶**ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰æ˜¾å¼çš„å®šä¹‰äº‹åŠ¡ï¼Œåˆ™ç”± DBMS æŒ‰ç…§ç¼ºçœè§„å®šè‡ªåŠ¨åˆ’åˆ†äº‹åŠ¡ï¼ˆé€šå¸¸ä¸€æ¡ DML è¯­å¥ä¸ºä¸€ä¸ªäº‹åŠ¡ï¼‰

äº‹åŠ¡ä¾‹å­

```sql
begin transaction
    read A
    A=A-100
    if A<0 then
        begin
            display 'Aä½™é¢ä¸è¶³'
            Rollback
        end
    else -- æ‹¨æ¬¾
        read B
        B=B+100
        display 'æ‹¨æ¬¾å®Œæˆ'
        Commit
end
```

1. `read(A)`
2. `A:=A-100`
3. `write(A)`
4. `read(B)`
5. `B:=B+100`
6. `write(B)`

-   äº‹åŠ¡æ˜¯å¹¶å‘æ§åˆ¶çš„åŸºæœ¬å•ä½ï¼Œä¹Ÿæ˜¯é‡åˆ°å„ç±»æ•°æ®åº“é”™è¯¯åè¿›è¡Œæ•°æ®æ¢å¤çš„å¤„ç†å•ä½
-   æ•°æ®çš„ç‰¹å¾ï¼ˆ**ACID**ï¼‰
    -   åŸå­æ€§ï¼ˆAtomicityï¼‰
        -   äº‹åŠ¡ä¸­åŒ…å«çš„æ“ä½œè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åš
        -   ç³»ç»Ÿåº”è¯¥ä¿è¯åªæ‰§è¡Œäº†ä¸€éƒ¨åˆ†çš„äº‹åŠ¡ä¸ä¼šå¯¹æ•°æ®åº“çŠ¶æ€äº§ç”Ÿå½±å“
            å¦‚æœäº‹åŠ¡å› ä¸ºè½¯ç¡¬ä»¶æ•…éšœåœ¨ç¬¬ä¸‰æ­¥å’Œç¬¬å…­æ­¥ä¹‹é—´ç»ˆæ­¢é€€å‡ºäº†ï¼Œéƒ¨åˆ†æ“ä½œå®Œæˆè€Œéƒ¨åˆ†æ“ä½œæœªå®Œæˆï¼Œåˆ™æ•°æ®åº“ä¼šå¤„äºä¸ä¸€è‡´çŠ¶æ€ï¼Œé’±ä¼šä¸¢å¤±
    -   éš”ç¦»æ€§ï¼ˆIsolationï¼‰
        -   **å¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°**
        -   ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œä»¥åŠä½¿ç”¨çš„æ•°æ®å¯¹å…¶ä»–å¹¶å‘äº‹åŠ¡æ˜¯éš”ç¦»çš„
        -   **æ¯ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œçš„æ—¶å€™åº”è¯¥æ„Ÿè§‰ä¸åˆ°å…¶ä»–äº‹åŠ¡çš„å­˜åœ¨**
            å¦‚æœåœ¨ç¬¬ä¸‰æ­¥å’Œç¬¬å…­æ­¥ä¸­é—´ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ T2 è¢«å…è®¸è®¿é—®å·²è¢«äº‹åŠ¡ T1 éƒ¨åˆ†ä¿®æ”¹äº†çš„æ•°æ®åº“ï¼Œåˆ™å®ƒçœ‹åˆ°çš„æ˜¯ä¸€ä¸ªâ€œä¸ä¸€è‡´â€çš„æ•°æ®åº“
    -   ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰
        -   _äº‹åŠ¡çš„éš”ç¦»æ‰§è¡Œå¿…é¡»ä¿è¯æ•°æ®åº“çš„ä¸€è‡´æ€§_ã€‚å‡å®šäº‹åŠ¡çš„ä¸€è‡´æ€§è§„å®šæ˜¯æ­£ç¡®çš„ï¼Œåˆ™æ•°æ®åº“åœ¨äº‹åŠ¡æ‰§è¡Œå‰æ˜¯ä¸€è‡´çš„ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½æš‚æ—¶å‡ºç°ä¸ä¸€è‡´ï¼Œè€Œå½“äº‹åŠ¡æ‰§è¡Œå®Œåï¼Œæ•°æ®åº“ä»ä¼šå¤„äºä¸€è‡´æ€§çŠ¶æ€
            _éšå«çš„å®Œæ•´æ€§çº¦æŸæ¡ä»¶_ï¼Œéœ€è¦ç”±ç”¨æˆ·æ ¹æ®ä¸šåŠ¡è§„åˆ™åœ¨äº‹åŠ¡ä»£ç ä¸­åšå‡ºâ€œä¸€è‡´æ€§â€çš„è§„å®šï¼Œæ¯”å¦‚åœ¨è½¬è´¦ä¾‹å­ä¸­ï¼ŒA å’Œ B è´¦æˆ·çš„é‡‘é¢æ€»å’Œåœ¨äº‹åŠ¡æ‰§è¡Œå‰åä¸èƒ½å‘ç”Ÿæ”¹å˜
    -   æŒä¹…æ€§ï¼ˆDurabilityï¼‰
        -   ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼ˆCommitï¼‰åï¼Œå®ƒå¯¹æ•°æ®åº“çš„å½±å“å¿…é¡»æ˜¯æ°¸ä¹…çš„ã€‚
-   äº‹åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ - æ´»åŠ¨çŠ¶æ€ï¼ˆActiveï¼‰ï¼šäº‹åŠ¡çš„åˆå§‹çŠ¶æ€ï¼›äº‹åŠ¡åœ¨æ‰§è¡Œæ—¶å¤„äºè¿™ç§çŠ¶æ€ - éƒ¨åˆ†æäº¤çŠ¶æ€ï¼ˆPartially Committedï¼‰ï¼šå¯¹æ•°æ®åº“è¿›è¡Œäº†éƒ¨åˆ†æ›´æ–°ï¼Œä½†æ˜¯äº‹åŠ¡å¹¶æœªæœ€åç»“æŸ - å¤±è´¥çŠ¶æ€ï¼ˆFailedï¼‰ï¼šç”±äºç‰©ç† or é€»è¾‘é”™è¯¯å¯¼è‡´äº‹åŠ¡è¯­å¥æ— æ³•ç»§ç»­è¿›è¡Œä¸‹å» - ä¸­æ­¢çŠ¶æ€ï¼ˆAbortedï¼‰ï¼šäº‹åŠ¡å›æ»šæ‰€æœ‰æ“ä½œï¼Œæ•°æ®åº“æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ - æäº¤çŠ¶æ€ï¼ˆCommittedï¼‰ï¼šäº‹åŠ¡æ­£ç¡®æ‰§è¡Œå®Œæˆçš„çŠ¶æ€
    ![](../assets/CleanShot%202023-06-08%20at%2019.54.23.png)

### å¹¶å‘æ“ä½œå¸¦æ¥çš„æ•°æ®ä¸ä¸€è‡´æ€§

> å½“åŒä¸€æ•°æ®åº“ç³»ç»Ÿä¸­æœ‰å¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œçš„æ—¶å€™ï¼Œå¦‚æœä¸åŠ ä»¥é€‚å½“æ§åˆ¶ï¼Œå¯èƒ½ä¼šç ´åäº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œäº§ç”Ÿæ•°æ®çš„ä¸ä¸€è‡´æ€§

#### ä¸¢å¤±ä¿®æ”¹ï¼ˆlost updateï¼‰

> æŒ‡**äº‹åŠ¡ 1 å’Œäº‹åŠ¡ 2 ä»æ•°æ®åº“è¯»å…¥åŒä¸€æ•°æ®å¹¶ä¿®æ”¹**ï¼Œäº‹åŠ¡ 2 çš„æäº¤ç»“æœç ´åäº†äº‹åŠ¡ 1 æäº¤çš„ç»“æœï¼Œå¯¼è‡´äº‹åŠ¡ 1 çš„ä¿®æ”¹è¢«ä¸¢å¤±

| step | T1         | T2         |
| ---- | ---------- | ---------- |
| 1    | read A=16  |            |
| 2    |            | read A=16  |
| 3    | A=A-1      |            |
| 4    | write A=15 |            |
| 5    |            | A=A-1      |
| 6    |            | write A=15 |

#### ä¸å¯é‡å¤è¯»ï¼ˆnon-repeatable readï¼‰

> ä¸å¯é‡å¤è¯»æ˜¯æŒ‡**äº‹åŠ¡ 1 è¯»å–æ•°æ®åï¼Œäº‹åŠ¡ 2 æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œä½¿äº‹åŠ¡ 1 æ— æ³•å†ç°å‰ä¸€æ¬¡çš„è¯»å–ç»“æœ**

ä¸‰ç§ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡ 1 è¯»å–æŸæ•°æ®å

1. äº‹åŠ¡ 2 å¯¹å…¶è¿›è¡Œäº†ä¿®æ”¹ï¼Œå½“äº‹åŠ¡ 1 å†æ¬¡è¯»å–è¯¥æ•°æ®æ—¶ï¼Œå¾—åˆ°ä¸å‰ä¸€æ¬¡ä¸åŒçš„å€¼
2. äº‹åŠ¡ 2 åˆ é™¤äº†å…¶ä¸­éƒ¨åˆ†è®°å½•ï¼Œäº‹åŠ¡ 1 å†æ¬¡è¯»å–æ•°æ®å‘ç°æŸäº›è®°å½•ç¥ç§˜æ¶ˆå¤±
3. äº‹åŠ¡ 2 æ’å…¥ä¸€äº›è®°å½•ï¼Œå½“äº‹åŠ¡ 1 å†æ¬¡æŒ‰ç›¸åŒæ¡ä»¶è¯»å–æ•°æ®æ—¶ï¼Œå‘ç°å¤šäº†ä¸€äº›è®°å½•

åä¸¤ç§ä¸å¯é‡å¤è¯»ä¹Ÿè¢«ç§°ä¸º*å¹»å½±ç°è±¡*

| step | T1                              | T2                            |
| ---- | ------------------------------- | ----------------------------- |
| 1    | read A=50;read B=100;sum(A,B)   |                               |
| 2    |                                 | read B=100;B=B\*2;write B=200 |
| 3    | read A=50;read B=200;_sum(A,B)_ |                               |

| step | T1                            | T2       |
| ---- | ----------------------------- | -------- |
| 1    | read A=50;read B=100;sum(A,B) |          |
| 2    |                               | delete B |
| 3    | read A;_read B_               |          |

#### è¯»è„æ•°æ®ï¼ˆdirty readï¼‰

> äº‹åŠ¡ 1 ä¿®æ”¹æŸä¸€æ•°æ®ï¼Œå¹¶å°†å…¶å†™å›ç£ç›˜ï¼Œäº‹åŠ¡ 2 **è¯»å–åŒä¸€æ•°æ®**åï¼Œäº‹åŠ¡ 1 ç”±äºæŸç§åŸå› è¢«æ’¤é”€ï¼Œè¿™æ—¶äº‹åŠ¡ 1 å·²ä¿®æ”¹è¿‡çš„æ•°æ®æ¢å¤åŸå€¼ï¼Œäº‹åŠ¡ 2 è¯»åˆ°çš„æ•°æ®å°±ä¸æ•°æ®åº“ä¸­çš„å°±ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œåˆç§°ä¸ºè„æ•°æ®

| step | T1                        | T2                     |
| ---- | ------------------------- | ---------------------- |
| 1    | read C=100;C=C\*2;write C |                        |
| 2    |                           | read C=200             |
| 3    | Rollback;now C=100;       |                        |
| 4    |                           | _C=200_ was dirty data |

> è¿™é‡Œå‘ç°çš„ä¸€ä¸ªå° bugï¼Œæ— æ³•è¯•ä¸‹è¡¨æ ¼å†…ä¸­æ–‡æ–‡æœ¬çš„è‡ªåŠ¨å¯¹é½

#### äº‹åŠ¡çš„å¹¶å‘æ§åˆ¶æœºåˆ¶

> å¯¹äº‹åŠ¡çš„å¹¶è¡Œè¿è¡Œé¡ºåºè¿›è¡Œåˆç†å®‰æ’ï¼Œè¾¾æˆäº‹åŠ¡çš„éš”ç¦»æ€§å’Œä¸€è‡´æ€§

##### è°ƒåº¦

> å°±æ˜¯**å¦¥å–„å®‰æ’å¹¶å‘è¿è¡Œçš„äº‹åŠ¡ä¸­å„æ¡æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº**
>
> å°†æ‰€æœ‰äº‹åŠ¡ä¸²è¡Œèµ·æ¥çš„è°ƒåº¦ç­–ç•¥ä¸€å®šæ˜¯æ­£ç¡®çš„è°ƒåº¦ç­–ç•¥ï¼ˆè™½ç„¶æ˜¯æœ€ä½æ•ˆçš„è°ƒåº¦ï¼‰

###### å‰é©±å›¾

> æ˜¯ä¸€ç§æœ‰æ•ˆçš„å†²çªå¯ä¸²è¡ŒåŒ–çš„æµ‹è¯•æ–¹å¼

-   æ˜¯ä¸€ç§æœ‰å‘å›¾
    -   é¡¶ç‚¹æ˜¯äº‹åŠ¡çš„åç§°
    -   å¯¹äºä¸¤ä¸ªé¡¶ç‚¹ï¼šäº‹åŠ¡ Ti å’Œäº‹åŠ¡ Tjï¼Œå¦‚æœè¿™ä¸¤ä¸ªäº‹åŠ¡å†²çªï¼Œä¸”æ˜¯äº‹åŠ¡ Ti å…ˆè®¿é—®çš„å†²çªèµ„æºï¼Œåˆ™ç”»ä¸€ä¸ªä» Ti åˆ° Tj çš„å¼§
    -   å¯ä»¥åœ¨å¼§ä¸Šæ ‡æ³¨å†²çªèµ„æºçš„åç§°

| step | T1       | T2       | T3       | T4       | T5      |
| ---- | -------- | -------- | -------- | -------- | ------- |
| 1    |          | read(X)  |          |          |         |
| 2    | read(Y)  |          |          |          |         |
| 3    | read(Z)  |          |          |          |         |
| 4    |          |          |          |          | read(V) |
| 5    |          |          |          |          | read(W) |
| 6    |          |          |          |          | read(W) |
| 7    |          | read(Y)  |          |          |         |
| 8    |          | write(Y) |          |          |         |
| 9    |          |          | write(Z) |          |         |
| 10   | read(U)  |          |          |          |         |
| 11   |          |          |          | read(Y)  |         |
| 12   |          |          |          | write(Y) |         |
| 13   |          |          |          | read(Z)  |         |
| 14   |          |          |          | write(Z) |         |
| 15   | read(U)  |          |          |          |         |
| 16   | write(U) |          |          |          |         |

```mermaid
flowchart LR
T1-->|Y|T2
T1-->|Z|T3
T2-->|Y|T4
T3-->|Z|T4
T5
```

1. å½“ä¸”ä»…å½“å‰é©±å›¾æ˜¯æ— ç¯çš„æ—¶å€™ï¼Œå¯¹åº”çš„è°ƒåº¦æ˜¯å†²çªå¯ä¸²è¡Œçš„(ä¹Ÿå°±æ˜¯è¯´**å¦‚æœæœ‰ç¯ï¼Œåˆ™å¿…å®šä¸å¯ä¸²è¡Œ**)
2. å½“å‰é©±å›¾æ˜¯æ— ç¯çš„æ—¶å€™ï¼Œå†²çªç­‰ä»·çš„ä¸²è¡ŒåŒ–è°ƒåº¦çš„äº‹åŠ¡æ‰§è¡Œé¡ºåºå¯ä»¥é€šè¿‡å¯¹*å›¾çš„æ‹“æ‰‘æ’åº*è·å¾—(T5->T1->T2->T3->T4)

å¦‚ä½•è¿›è¡Œæ‹“æ‰‘æ’åº ğŸ‘‡ğŸ»

1. é€‰æ‹©æ— å‰é©±èŠ‚ç‚¹è¾“å‡º
2. åˆ é™¤å¯¹åº”èŠ‚ç‚¹æœ‰å‘è¾¹
3. å¾ªç¯

**ä»€ä¹ˆæ˜¯å¯æ¢å¤çš„è°ƒåº¦**

> å¦‚æœ T9 åœ¨ step3 åç«‹å³æäº¤ï¼Œä¸” T8 åœ¨ T9 æäº¤åæ‰§è¡Œå¤±è´¥å›æ»šï¼Œæ­¤æ—¶ä¼šå¯¼è‡´æ•°æ®åº“å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€

| step | T8       | T9      |
| ---- | -------- | ------- |
| 1    | read(A)  |         |
| 2    | write(A) |         |
| 3    |          | read(A) |
| 4    | read(B)  |         |

å¦‚ä½•é¿å…ä¸Šè¿°æƒ…å†µçš„å‘ç”Ÿï¼šè‹¥**äº‹åŠ¡ Tj è¯»å–äº† Ti ä¹‹å‰å†™å…¥çš„æ•°æ®**ï¼Œåˆ™*Ti çš„æäº¤æ“ä½œ*åº”è¯¥åœ¨*Tj çš„æäº¤æ“ä½œ* **ä¹‹å‰**å‘ç”Ÿï¼Œè¿™å¯ä»¥é¿å…å‰é¢æ•°æ®å›æ»šå¯¼è‡´çš„ä¸ä¸€è‡´é—®é¢˜

**çº§è”å›æ»š**

> æ— è®ºæ˜¯ä»€ä¹ˆåŸå› ï¼Œå¦‚æœ Ti å¤±è´¥äº†ï¼Œä¸ºäº†ä¿è¯äº‹åŠ¡çš„åŸå­æ€§å°±å¿…é¡»å›æ»šè¯¥äº‹åŠ¡ï¼ŒåŒæ—¶ç”±äºç³»ç»Ÿä¸­äº‹åŠ¡çš„å¹¶å‘æ‰§è¡Œï¼Œå°±å¿…é¡»å›æ»šå“ªäº›ä¾èµ–äº Ti äº‹åŠ¡çš„äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯é‚£äº›è¯»å–äº† Ti æ‰€å†™æ•°æ®çš„äº‹åŠ¡ä¹Ÿå¿…é¡»è¢«åŒæ—¶å›æ»šæ‰
>
> è°ƒåº¦ 10 æ˜¯å¯æ¢å¤çš„è°ƒåº¦ï¼Œå¦‚æœå®ƒå¤±è´¥äº†ï¼Œå°±éœ€è¦å›æ»š T10ã€T11ã€T12 ä¸‰ä¸ªäº‹åŠ¡

| step | T10      | T11      | T12     |
| ---- | -------- | -------- | ------- |
| 1    | read(A)  |          |         |
| 2    | read(B)  |          |         |
| 3    | write(A) |          |         |
| 4    |          | read(A)  |         |
| 5    |          | write(A) |         |
| 6    |          |          | read(A) |

**æ— çº§è”è°ƒåº¦**

> è‹¥äº‹åŠ¡ Tj è¯»å–äº†äº‹åŠ¡ Ti ä¹‹å‰å†™å…¥çš„æ•°æ®ï¼Œåˆ™ Ti çš„æäº¤æ“ä½œåº”è¯¥åœ¨ Tj çš„è¯»å–æ“ä½œä¹‹å‰å‘ç”Ÿ
>
> æ— çº§è”è°ƒåº¦ä¹Ÿæ˜¯å¯æ¢å¤è°ƒåº¦ï¼Œå¹¶ä¸”æ˜¯ä¸€ç§è¾ƒé«˜çš„è°ƒåº¦è¦æ±‚

#### é”

> åŸºæœ¬å°é”ç±»å‹ï¼š
>
> -   æ’ä»–é”ï¼ˆeXclusive lockï¼Œç®€ç§° X é”ï¼‰
> -   å…±äº«é”ï¼ˆShare lockï¼Œç®€ç§° S é”ï¼‰

-   X é”ï¼šè‹¥äº‹åŠ¡ T å¯¹æ•°æ®å¯¹è±¡ A åŠ ä¸Š X é”ï¼Œåˆ™**åªå…è®¸ T è¯»å–å’Œä¿®æ”¹ A**ï¼Œ_å…¶ä»–ä»»ä½•äº‹åŠ¡éƒ½ä¸èƒ½å†å¯¹ A åŠ ä»»ä½•ç±»å‹çš„é”_ï¼Œç›´åˆ° T é‡Šæ”¾ A ä¸Šçš„é”
-   S é”ï¼šè‹¥äº‹åŠ¡ T å¯¹æ•°æ®å¯¹è±¡ A åŠ ä¸Š S é”ï¼Œåˆ™**å…¶ä»–äº‹åŠ¡åªèƒ½å†å¯¹ A åŠ  S é”**ï¼Œè€Œä¸èƒ½åŠ  X é”ï¼Œç›´åˆ° T é‡Šæ”¾ A ä¸Šçš„ S é”ï¼Œè¿™å°±*ä¿è¯äº†å…¶ä»–äº‹åŠ¡åœ¨ T é‡Šæ”¾ R ä¸Šçš„ S é”ä¹‹å‰ï¼Œåªèƒ½è¯»å– Rï¼Œè€Œä¸èƒ½å†å¯¹ R åšä»»ä½•ä¿®æ”¹*

**å°é”åè®®**ï¼šåŸºäºé”è¿™ä¸ªå·¥å…·ï¼Œæ¶‰åŠä¸€ç»„è§„åˆ™ï¼Œæ¥åˆç†å®‰æ’ä¸€ç»„å¹¶å‘äº‹åŠ¡çš„äº¤é”™è¿è¡Œçš„æŒ‡ä»¤ï¼Œä½¿å¾—äº§ç”Ÿçš„è°ƒåº¦æ˜¯å¯ä¸²è¡Œçš„å’Œå¯æ¢å¤çš„ï¼Œç”šè‡³æ˜¯æ— çº§è”çš„

##### ä¸‰çº§å°é”åè®®

###### ä¸€çº§å°é”åè®®

> äº‹åŠ¡ T åœ¨ä¿®æ”¹æ•°æ® R ä¹‹å‰å¿…é¡»å…ˆå¯¹å…¶åŠ **X é”**ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸæ‰é‡Šæ”¾
>
> å› ä¸ºè¯»æ•°æ®ä¸éœ€è¦åŠ é”ï¼Œæ‰€ä»¥å®ƒä¸èƒ½ä¿è¯ä¸å¯é‡å¤è¯»å’Œâ€œè„è¯»â€

æ²¡æœ‰*ä¸¢å¤±ä¿®æ”¹*

| step | T1               | T2         |
| ---- | ---------------- | ---------- |
| 1    | Xlock A;get lock |            |
| 2    | read A=16        |            |
| 3    |                  | Xlock A    |
| 4    | A=A-1            | wait       |
| 5    | write A=15       | wait       |
| 6    | commit           | wait       |
| 7    | Unlock A         | wait       |
| 8    |                  | get lock   |
| 9    |                  | read A=15  |
| 10   |                  | A=A-1      |
| 11   |                  | write A=14 |
| 12   |                  | commit     |
| 13   |                  | unlock A   |

æ— æ³•é¿å…*ä¸å¯é‡å¤è¯»*

| step | T1           | T2          |
| ---- | ------------ | ----------- |
| 1    | read A=50    |             |
| 2    | read B=100   |             |
| 3    | sum(A,B)=150 |             |
| 4    |              | Xlock B     |
| 5    |              | get lock    |
| 6    |              | read B=100  |
| 7    |              | B=B\*2      |
| 8    |              | write B=200 |
| 9    |              | commit      |
| 10   |              | Unlock B    |
| 11   | read A=50    |             |
| 12   | read B=200   |             |
| 13   | sum(A,B)=250 |             |

###### äºŒçº§å°é”åè®®

> åœ¨ä¸€çº§å°é”åè®®çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚**äº‹åŠ¡ T åœ¨è¯»å–æ•°æ® R å‰å¿…é¡»å…ˆåŠ  S é”**ï¼Œè¯»å®Œåå³å¯é‡Šæ”¾ S é”
>
> äºŒçº§å°é”åè®®å¯ä»¥é˜²æ­¢ä¸¢å¤±ä¿®æ”¹å’Œè¯»â€œè„â€æ•°æ®

é˜²æ­¢*è„è¯»*

| step | T1                                  | T2        |
| ---- | ----------------------------------- | --------- |
| 1    | Xlock A;get Xlock                   |           |
| 2    | read A=16                           |           |
| 3    |                                     |           |
| 4    | A=A-1                               |           |
| 5    | write A=15                          |           |
| 6    |                                     | Slock A   |
| 7    | Rollback(maybe if failed,Rollback?) | wait      |
| 8    | Unlock A                            | wait      |
| 9    |                                     | get Slock |
| 10   |                                     | read A=15 |
| 11   |                                     | unlock A  |

###### ä¸‰çº§å°é”åè®®

> åœ¨ä¸€çº§å°é”åè®®çš„åŸºç¡€ä¸Šï¼Œè¦æ±‚äº‹åŠ¡ T åœ¨è¯»å–æ•°æ® R ä¹‹å‰å¿…é¡»å…ˆå¯¹å…¶åŠ  S é”ï¼Œ*ç›´åˆ°äº‹åŠ¡ç»“æŸ*æ‰èƒ½é‡Šæ”¾
>
> ä¸‰çº§å°é”åè®®å¯é˜²æ­¢ä¸¢å¤±ä¿®æ”¹ã€è¯»è„æ•°æ®å’Œä¸å¯é‡å¤è¯»

###### äº‹åŠ¡éš”ç¦»çº§åˆ«

> æ•°æ®åº“å…è®¸ç”¨æˆ·é€‰æ‹©éš”ç¦»çº§åˆ«ï¼Œ**ä¸åŒéš”ç¦»çº§åˆ«å¯¹åº”äºä¸åŒç­‰çº§çš„å°é”åè®®**

....

##### äºŒé˜¶æ®µé”åè®®

> ä¸‰çº§å°é”åè®®è®¨è®ºäº†å°é”çš„æ—¶æœºï¼Œç›®çš„æ˜¯ä»ä¸åŒç¨‹åº¦ä¸Šè§£å†³æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜ï¼Œä½†æ²¡æœ‰è®¨è®ºè°ƒåº¦çš„æ­£ç¡®æ€§
>
> ä¸ºäº†ä¿è¯å¹¶è¡Œæ“ä½œçš„æ­£ç¡®æ€§ï¼ŒDBMS çš„å¹¶è¡Œæ§åˆ¶æœºåˆ¶å¿…é¡»æä¾›ä¸€å®šçš„æ‰‹æ®µæ¥ä¿è¯è°ƒåº¦æ˜¯å¯ä¸²è¡ŒåŒ–çš„
>
> ä¸¤é˜¶æ®µé”åè®®ï¼ˆ Two-Phase Lockingï¼Œç®€ç§°**2PL**ï¼‰æ˜¯ä¸€ç§èƒ½å¤Ÿä¿è¯å¹¶å‘æ‰§è¡Œç»“æœæ­£ç¡®æ€§çš„å°é”åè®®

1. **åœ¨å¯¹ä»»ä½•æ•°æ®è¿›è¡Œè¯»ã€å†™æ“ä½œä¹‹å‰ï¼Œäº‹åŠ¡é¦–å…ˆè¦è·å¾—å¯¹è¯¥æ•°æ®çš„å°é”**
2. åœ¨é‡Šæ”¾ä¸€ä¸ªå°é”ä¹‹åï¼Œäº‹åŠ¡ä¸å†è·å¾—ä»»ä½•å…¶ä»–å°é”

_å¯¹ä¸€ç»„éµå®ˆä¸¤æ®µé”åè®®çš„äº‹åŠ¡ï¼Œå¯ä»¥å®ç°å¯ä¸²è¡ŒåŒ–è°ƒåº¦ï¼Œä½¿å¾—å…¶å¹¶è¡Œæ‰§è¡Œçš„ç»“æœä¸€å®šæ˜¯æ­£ç¡®çš„_

ä¸¤æ®µé”åè®®å¯ä»¥è§£å†³æ‰€æœ‰æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä½†**ä¸èƒ½è§£å†³çº§è”å›æ»š**é—®é¢˜

åœ¨ä¸¤é˜¶æ®µé”åè®®åŸºç¡€ä¸Šï¼Œå¢åŠ è§„åˆ™ï¼šäº‹åŠ¡è·å¾—çš„é”åªæœ‰åœ¨äº‹åŠ¡ç»“æŸæ—¶å€™æ‰é‡Šæ”¾å¯è§£å†³ ğŸ‘†ğŸ» é—®é¢˜

ç¬¬ä¸‰çº§å°é”åè®®ä¸ä¸¥æ ¼çš„ä¸¤é˜¶æ®µé”åè®®ä¸€è‡´ï¼Œ**éµå¾ªç¬¬ä¸‰çº§å°é”åè®®çš„äº‹åŠ¡å¿…ç„¶éµå®ˆä¸¤é˜¶æ®µé”åè®®**

| T1   | T1 buffer | T2     | T2 buffer | database |
| ---- | --------- | ------ | --------- | -------- |
| R(x) | 100       |        |           | 100,1000 |
| W(x) | 200       |        |           | 200,1000 |
|      |           | R(x)   | 200       | 200,1000 |
| R(y) | 200,1000  |        |           | 200,2000 |
| W(y) | 200,2000  |        |           | 200,2000 |
|      |           | R(Y)   | 200,2000  | 200,2000 |
|      |           | W(y)   | 200,3000  | 200,3000 |
|      |           | W(x)   | 300,3000  | 300,3000 |
|      |           | commit |           |          |

è°ƒåº¦ï¼š

-   ä¸²è¡Œè°ƒåº¦
-   éä¸²è¡Œè°ƒåº¦
    é€šè¿‡**å‰é©±å›¾**åˆ¤æ–­æ˜¯å¦å¯ä¸²è¡ŒåŒ–
    -   å¯ä¸²è¡Œè°ƒåº¦ï¼šåªè€ƒè™‘å†²çªä¸²è¡ŒåŒ–
    -   ä¸å¯ä¸²è¡Œè°ƒåº¦
        -   å¯æ¢å¤è°ƒåº¦ï¼šè°ƒåº¦ä¸­çš„æ‰€æœ‰äº‹åŠ¡ä»…åœ¨å®ƒä»ä¸­è¯»å–å€¼çš„æ‰€æœ‰äº‹åŠ¡éƒ½å®Œå…¨æ‰§è¡Œåæ‰æäº¤ï¼Œåˆ™è°ƒåº¦æ˜¯å¯æ¢å¤çš„
        -   ä¸å¯å›å¤è°ƒåº¦ï¼šT2 ä» T1 ä¸­è¯»å–äº†æ•°æ®ï¼Œå¹¶ä¸”åœ¨ T1 æäº¤ä¹‹å‰æäº¤ï¼Œåˆ™è¯¥è°ƒåº¦ä¸å¯æ¢å¤ï¼ˆå¦‚æœ T1 æ‰§è¡Œå¤±è´¥ï¼Œéœ€è¦å›æ»šï¼Œç”±äº T2 æ­¤æ—¶å·²ç»æäº¤æ— æ³•å›æ»šï¼Œä½†æ˜¯ T1 å¯å›æ»šï¼Œäºæ˜¯ T2 ä¸­è¯»å–åˆ°çš„æ•°æ®å°±å’Œæœ€å T1 å›æ»šæ¢å¤å¾—åˆ°çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™ä¹Ÿå°±æ˜¯è„è¯»ï¼‰

## å¤‡ä»½ä¸æ¢å¤

-   äº‹åŠ¡åŸè¯­
    -   input(X):æŠŠæ•°æ®é¡¹ X è¯»åˆ°å†…å­˜ç¼“å†²åŒº
    -   read(X,t):æŠŠæ•°æ®é¡¹ X æ‹·è´åˆ°äº‹åŠ¡çš„æœ¬åœ°å˜é‡ t ä¸­
    -   write(X,t):æŠŠäº‹åŠ¡æœ¬åœ°å˜é‡ t æ‹·è´ä¼šæ•°æ®é¡¹ X ä¸­
    -   output(X):å°†æ•°æ®é¡¹ X å†™åˆ°ç£ç›˜é‡Œè®°å½•ä¸‹æ¥

# æ‚

SD(SNO,SN,AGE,DEPT,MN)

é¦–å…ˆåˆ†è§£ä¸ºæ ¹æ®å®ä½“å…³ç³»åˆ†è§£ä¸ºæè¿°å­¦ç”Ÿä¸»ä½“çš„ S(SNO,SN,AGE)å’Œæè¿°ç³»ä¸»ä½“çš„ D(DEPT,MN)

SNO -> DEPT DEPT !-> SNO DEPT -> MN

æ±‚å±æ€§é›†$X(X\subseteq U)$å…³äº$U$ä¸Šçš„å‡½æ•°ä¾èµ–é›†$F$çš„é—­åŒ…$X_{F^+}$çš„ç®—æ³•

-   è¾“å…¥ï¼š$X,F$
-   è¾“å‡ºï¼š$X_{F^+}$

1. ä»¤$X(0)=X,i=0$
2. æ±‚$B$,è¿™é‡Œ$B=\{A|(\exist V)(\exist W)(V\to W\in F\land V\subseteq X(i)\land A\subset W)\}$;
   V æ˜¯ X çš„å­é›†ï¼ŒW æ˜¯ V æ ¹æ®å‡½æ•°ä¾èµ– F æ¨å‡ºçš„é›†åˆï¼ŒA åˆ™æ˜¯ W çš„å­å…ƒç´ 
   æ€»ç»“ä¸€å¥è¯ï¼ŒB å°±æ˜¯ X(i)æ ¹æ®å‡½æ•°ä¾èµ–é›† F æ¨å‡ºçš„å…ƒç´ é›†åˆ
3. $X(i+1)=B\cup X(i)$
4. åˆ¤æ–­$X(i+1)?=X(i)$
5. è‹¥ç›¸ç­‰æˆ–è€…$X(i)=U$,åˆ™$X(i)$å°±æ˜¯$X_{F^+}$,ç®—æ³•ç»ˆæ­¢
6. è‹¥å¦,åˆ™ $i=i+1$,è¿”å›ç¬¬ 2 æ­¥ç»§ç»­

å·²çŸ¥å…³ç³»æ¨¡å¼$R<U,F>$,å…¶ä¸­$U=\{A,B,C,D,E\};F=\{AB\to C,B\to D,C\to E,EC\to B,AC\to B\}$,æ±‚$(AB)_{F^+}$

1. $X(0)=\{AB\}$
2. $X(1)=\{ABCD\}$
3. $X(2)=\{ABCDE\}$

å¯¹äºå…³ç³»æ¨¡å¼$S<U,F>$,å…¶ä¸­
$U=\{SNO,Sdept,MN,Cname,G\}\\ F=\{SNO\to Sdept,Sdept\to MN,(SNO,Cname)\to G\}$

è®¾$F^{'}=\{SNO\to Sdept,SNO\to MN,Sdept\to MN,(SNO,Cname)\to G,(SNO,Sdept)\to Sdept\}$

åˆ™$F^{'}$ä¸æ˜¯æœ€å°è¦†ç›–é›†ï¼Œè€Œ$F$æ˜¯æœ€å°è¦†ç›–é›†

å› ä¸º$F^{'}-\{SNO-MN\}ä¸F^{'}ç­‰ä»·$

æœ€å°ä¾èµ–é›†çš„æ„é€ æ–¹æ³•

1. é€ä¸€æ£€æŸ¥ F ä¸­å„ä¸ªå‡½æ•°çš„ä¾èµ–ï¼Œå¯¹äº$X\to A_1A_2A_3...$ç±»çš„å‡½æ•°ï¼Œåˆ©ç”¨åˆ†è§£è§„åˆ™åˆ†è§£ä¸º$\{X\to A_j|j=1,2,...,k\}$
2. é€ä¸€æ£€æŸ¥ F ä¸­å„ä¸ªå‡½æ•°ä¾èµ–$FD_i: X\to A$,ä»¤$G=F-\{X\to A\}$,è‹¥$A\in X_G^{+}$,åˆ™å¯ä»¥ä» F ä¸­å»é™¤æ­¤ä¾èµ–ï¼ˆF å»é™¤è¯¥ä¾èµ–åï¼Œä»ç„¶å¯ä»¥é€šè¿‡ G è‡ªèº«æ¨å¯¼å¾—å‡º Aï¼Œæ‰€ä»¥è¯¥ä¾èµ–æ˜¯å†—ä½™ä¾èµ–ï¼‰
3. é€ä¸€æ£€æŸ¥ F ä¸­å„ä¸ªå‡½æ•°ä¾èµ–$FD_i: X\to A$,è®¾$X=B_1B_2B_3...B_m$,é€ä¸€è€ƒå¯Ÿ$B_i$,è‹¥$A\in (X-B_i)_F^{+}$,åˆ™å¯ä»¥ä»¥$X-B_i$å–ä»£$X$(æ¨å¯¼æ¡ä»¶å†—ä½™)

ç»è¿‡ä¸Šè¿°å¤„ç†åï¼Œæœ€åå‰©ä¸‹æ¥çš„å°±ä¸€å®šæ˜¯æå°ä¾èµ–é›†

$F=\{A\to B,B\to A,B\to C,A\to C,C\to A\}$

1. æ— å†—ä½™
2. å»é™¤ A->B,å‘ç°æ— æ³•æ¨å¯¼å‡º B
   å»é™¤ B->A,å‘ç°å¯ä»¥æ¨å¯¼å‡º A,ç›´æ¥å»é™¤
   å»é™¤ B->C,å‘ç°å¯ä»¥æ¨å¯¼å‡º C,ç›´æ¥å»é™¤
   å»é™¤ A->C,å‘ç°æ— æ³•æ¨å¯¼å‡º C
   å»é™¤ C->A,å‘ç°æ— æ³•æ¨å¯¼å‡º A
   å¾—åˆ°$F=\{A\to B,A\to C,C\to A\}$
3. æ— å†—ä½™

æœ€ç»ˆå¾—åˆ°æœ€å°ä¾èµ–é›†ä¸º$F=\{A\to B,A\to C,C\to A\}$

è½¬æ¢è§„åˆ™

1. ä¸€ä¸ªå®ä½“å‹è½¬æ¢ä¸ºä¸€ä¸ªå…³ç³»æ¨¡å¼
2. ä¸€ä¸ª m:n è”ç³»è½¬æ¢ä¸ºä¸€ä¸ªå…³ç³»æ¨¡å¼
3. ä¸€ä¸ª 1:1 è”ç³»å¯ä»¥è½¬æ¢ä¸ºä¸€ä¸ªç‹¬ç«‹çš„å…³ç³»æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥ä¸ä»»æ„ä¸€ç«¯çš„å…³ç³»æ¨¡å¼åˆå¹¶
4. ä¸€ä¸ª 1:n è”ç³»å¯ä»¥è½¬æ¢ä¸ºä¸€ä¸ªç‹¬ç«‹çš„å…³ç³»æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥ä¸ n ç«¯å¯¹åº”çš„å…³ç³»æ¨¡å¼åˆå¹¶
5. ä¸‰ä¸ªæˆ–ä¸‰ä¸ªä»¥ä¸Šå®ä½“é—´çš„ä¸€ä¸ªå¤šå…ƒè”ç³»å¯ä»¥è½¬æ¢ä¸ºä¸€ä¸ªå…³ç³»æ¨¡å¼
